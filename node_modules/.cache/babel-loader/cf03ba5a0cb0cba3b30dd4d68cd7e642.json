{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nimport _objectSpread from \"@babel/runtime/helpers/objectSpread2\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _createSuper from \"@babel/runtime/helpers/createSuper\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport { createScopedElement } from \"../../lib/jsxRuntime\";\nimport React, { Component } from 'react';\nimport { classNames } from \"../../lib/classNames\";\nimport { getClassName } from \"../../helpers/getClassName\";\nimport { animationEvent } from \"../../lib/supportEvents\";\nimport { ANDROID, VKCOM } from \"../../lib/platform\";\nimport { withPlatform } from \"../../hoc/withPlatform\";\nimport { withContext } from \"../../hoc/withContext\";\nimport { ConfigProviderContext } from \"../ConfigProvider/ConfigProviderContext\";\nimport { SplitColContext } from \"../SplitCol/SplitCol\";\nimport { AppRootPortal } from \"../AppRoot/AppRootPortal\";\nimport { canUseDOM, withDOM } from \"../../lib/dom\";\nimport { ScrollContext } from \"../AppRoot/ScrollContext\";\nimport { getNavId } from \"../../lib/getNavId\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nvar warn = warnOnce('Root');\n\nvar Root = /*#__PURE__*/function (_Component) {\n  _inherits(Root, _Component);\n\n  var _super = _createSuper(Root);\n\n  function Root(props) {\n    var _this;\n\n    _classCallCheck(this, Root);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"animationFinishTimeout\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"viewNodes\", {});\n\n    _defineProperty(_assertThisInitialized(_this), \"onAnimationEnd\", function (e) {\n      if (!e || ['vkui-root-android-animation-hide-back', 'vkui-root-android-animation-show-forward', 'vkui-root-ios-animation-hide-back', 'vkui-root-ios-animation-show-forward'].includes(e.animationName)) {\n        var isBack = _this.state.isBack;\n        var prevView = _this.state.prevView;\n        var nextView = _this.state.nextView;\n\n        _this.setState({\n          activeView: nextView,\n          prevView: null,\n          nextView: null,\n          visibleViews: [nextView],\n          transition: false,\n          isBack: undefined\n        }, function () {\n          _this.props.scroll.scrollTo(0, isBack ? _this.state.scrolls[_this.state.activeView] : 0);\n\n          _this.props.onTransition && _this.props.onTransition({\n            isBack: isBack,\n            from: prevView,\n            to: nextView\n          });\n        });\n      }\n    });\n\n    _this.state = {\n      activeView: props.activeView,\n      prevView: null,\n      nextView: null,\n      visibleViews: [props.activeView],\n      isBack: undefined,\n      scrolls: {},\n      transition: false\n    };\n    return _this;\n  }\n\n  _createClass(Root, [{\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState) {\n      var _this2 = this;\n\n      if (this.props.popout && !prevProps.popout) {\n        this.blurActiveElement();\n      } // Нужен переход\n\n\n      if (this.props.activeView !== prevProps.activeView) {\n        var pageYOffset = this.props.scroll.getScroll().y;\n        var firstLayerId = [].concat(prevProps.children).map(function (view) {\n          return getNavId(view.props, warn);\n        }).find(function (id) {\n          return id === prevProps.activeView || id === _this2.props.activeView;\n        });\n        var isBack = firstLayerId === this.props.activeView;\n        this.blurActiveElement();\n        var nextView = this.props.activeView;\n        var prevView = prevProps.activeView;\n        this.setState({\n          scrolls: _objectSpread(_objectSpread({}, this.state.scrolls), {}, _defineProperty({}, prevProps.activeView, pageYOffset)),\n          transition: true,\n          activeView: null,\n          nextView: nextView,\n          prevView: prevView,\n          visibleViews: [nextView, prevView],\n          isBack: isBack\n        });\n      } // Начался переход\n\n\n      if (!prevState.transition && this.state.transition) {\n        var prevViewElement = this.viewNodes[this.state.prevView];\n        var nextViewElement = this.viewNodes[this.state.nextView];\n\n        var setPanelScroll = function setPanelScroll(e, scroll) {\n          // eslint-disable-next-line no-restricted-properties\n          var pan = e.querySelector('[data-vkui-active-panel=true]');\n          pan && (pan.scrollTop = scroll);\n        };\n\n        setPanelScroll(prevViewElement, this.state.scrolls[this.state.prevView]);\n\n        if (this.state.isBack) {\n          setPanelScroll(nextViewElement, this.state.scrolls[this.state.nextView]);\n        }\n\n        this.waitAnimationFinish(this.state.isBack ? prevViewElement : nextViewElement, this.onAnimationEnd);\n      }\n    }\n  }, {\n    key: \"shouldDisableTransitionMotion\",\n    value: function shouldDisableTransitionMotion() {\n      return this.props.configProvider.transitionMotionEnabled === false || !this.props.splitCol.animate;\n    }\n  }, {\n    key: \"waitAnimationFinish\",\n    value: function waitAnimationFinish(elem, eventHandler) {\n      if (this.shouldDisableTransitionMotion()) {\n        eventHandler();\n        return;\n      }\n\n      if (animationEvent.supported) {\n        elem.removeEventListener(animationEvent.name, eventHandler);\n        elem.addEventListener(animationEvent.name, eventHandler);\n      } else {\n        clearTimeout(this.animationFinishTimeout);\n        this.animationFinishTimeout = setTimeout(eventHandler.bind(this), this.props.platform === ANDROID || this.props.platform === VKCOM ? 300 : 600);\n      }\n    }\n  }, {\n    key: \"blurActiveElement\",\n    value: function blurActiveElement() {\n      if (canUseDOM && this.document.activeElement) {\n        this.document.activeElement.blur();\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var _this$props = this.props,\n          popout = _this$props.popout,\n          modal = _this$props.modal,\n          platform = _this$props.platform,\n          splitCol = _this$props.splitCol,\n          configProvider = _this$props.configProvider,\n          _1 = _this$props.activeView,\n          onTransition = _this$props.onTransition,\n          window = _this$props.window,\n          document = _this$props.document,\n          scroll = _this$props.scroll,\n          restProps = _objectWithoutProperties(_this$props, [\"popout\", \"modal\", \"platform\", \"splitCol\", \"configProvider\", \"activeView\", \"onTransition\", \"window\", \"document\", \"scroll\"]);\n\n      var _this$state = this.state,\n          transition = _this$state.transition,\n          isBack = _this$state.isBack,\n          prevView = _this$state.prevView,\n          activeView = _this$state.activeView,\n          nextView = _this$state.nextView;\n      var Views = React.Children.toArray(this.props.children).filter(function (view) {\n        return _this3.state.visibleViews.includes(getNavId(view.props, warn));\n      });\n      var baseClassName = getClassName('Root', platform);\n      var disableAnimation = this.shouldDisableTransitionMotion();\n      return createScopedElement(\"div\", _extends({}, restProps, {\n        vkuiClass: classNames(baseClassName, {\n          'Root--transition': !disableAnimation && transition,\n          'Root--no-motion': disableAnimation\n        })\n      }), Views.map(function (view) {\n        var viewId = getNavId(view.props, warn);\n        return createScopedElement(\"div\", {\n          key: viewId,\n          ref: function ref(e) {\n            return _this3.viewNodes[viewId] = e;\n          },\n          vkuiClass: classNames('Root__view', {\n            'Root__view--hide-back': viewId === prevView && isBack,\n            'Root__view--hide-forward': viewId === prevView && !isBack,\n            'Root__view--show-back': viewId === nextView && isBack,\n            'Root__view--show-forward': viewId === nextView && !isBack,\n            'Root__view--active': viewId === activeView\n          })\n        }, view);\n      }), createScopedElement(AppRootPortal, null, !!popout && createScopedElement(\"div\", {\n        vkuiClass: \"Root__popout\"\n      }, popout), !!modal && createScopedElement(\"div\", {\n        vkuiClass: \"Root__modal\"\n      }, modal)));\n    }\n  }, {\n    key: \"document\",\n    get: function get() {\n      return this.props.document;\n    }\n  }]);\n\n  return Root;\n}(Component);\n\n_defineProperty(Root, \"defaultProps\", {\n  popout: null\n});\n\nexport default withContext(withContext(withContext(withPlatform(withDOM(Root)), SplitColContext, 'splitCol'), ConfigProviderContext, 'configProvider'), ScrollContext, 'scroll');","map":{"version":3,"sources":["../../../src/components/Root/Root.tsx"],"names":["warn","warnOnce","Root","Component","activeView","props","prevView","nextView","visibleViews","isBack","scrolls","transition","popout","prevProps","prevState","pageYOffset","firstLayerId","getNavId","view","id","prevViewElement","nextViewElement","setPanelScroll","pan","e","elem","eventHandler","animationEvent","clearTimeout","setTimeout","undefined","from","to","canUseDOM","modal","platform","splitCol","configProvider","_1","onTransition","window","document","scroll","restProps","Views","baseClassName","getClassName","disableAnimation","classNames","viewId","withContext","withPlatform","withDOM"],"mappings":"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","sourcesContent":["import React, { Component, HTMLAttributes, ReactElement, ReactNode } from 'react';\nimport { classNames } from '../../lib/classNames';\nimport { getClassName } from '../../helpers/getClassName';\nimport { animationEvent } from '../../lib/supportEvents';\nimport { ANDROID, VKCOM } from '../../lib/platform';\nimport { withPlatform } from '../../hoc/withPlatform';\nimport { withContext } from '../../hoc/withContext';\nimport { HasPlatform } from '../../types';\nimport { ConfigProviderContext, ConfigProviderContextInterface } from '../ConfigProvider/ConfigProviderContext';\nimport { SplitColContextProps, SplitColContext } from '../SplitCol/SplitCol';\nimport { AppRootPortal } from '../AppRoot/AppRootPortal';\nimport { canUseDOM, DOMProps, withDOM } from '../../lib/dom';\nimport { ScrollContext, ScrollContextInterface } from '../AppRoot/ScrollContext';\nimport { getNavId, NavIdProps } from '../../lib/getNavId';\nimport { warnOnce } from '../../lib/warnOnce';\n\nconst warn = warnOnce('Root');\n\nexport interface RootProps extends HTMLAttributes<HTMLDivElement>, HasPlatform, NavIdProps {\n  activeView: string;\n  onTransition?(params: { isBack: boolean; from: string; to: string }): void;\n  /**\n   * @deprecated будет удалено в 5.0.0. Используйте одноименное свойство у `SplitLayout`.\n   *\n   * Свойство для отрисовки `Alert`, `ActionSheet` и `ScreenSpinner`.\n   */\n  popout?: ReactNode;\n  /**\n   * @deprecated будет удалено в 5.0.0. Используйте одноименное свойство у `SplitLayout`.\n   *\n   * Свойство для отрисовки `ModalRoot`.\n   */\n  modal?: ReactNode;\n  /**\n   * @ignore\n   */\n  splitCol?: SplitColContextProps;\n  /**\n   * @ignore\n   */\n  configProvider?: ConfigProviderContextInterface;\n  /**\n   * @ignore\n   */\n  scroll?: ScrollContextInterface;\n}\n\nexport type AnimationEndCallback = (e?: AnimationEvent) => void;\n\nexport interface RootState {\n  activeView: string;\n  prevView: string;\n  nextView: string;\n  visibleViews: [string] | [string, string];\n  isBack: boolean;\n  scrolls: {\n    [index: string]: number;\n  };\n  transition: boolean;\n}\n\nclass Root extends Component<RootProps & DOMProps, RootState> {\n  constructor(props: RootProps) {\n    super(props);\n\n    this.state = {\n      activeView: props.activeView,\n      prevView: null,\n      nextView: null,\n      visibleViews: [props.activeView],\n      isBack: undefined,\n      scrolls: {},\n      transition: false,\n    };\n  }\n\n  static defaultProps: Partial<RootProps> = {\n    popout: null,\n  };\n\n  private animationFinishTimeout: ReturnType<typeof setTimeout>;\n  private viewNodes: { [id: string]: HTMLElement } = {};\n\n  get document() {\n    return this.props.document;\n  }\n\n  componentDidUpdate(prevProps: RootProps, prevState: RootState) {\n    if (this.props.popout && !prevProps.popout) {\n      this.blurActiveElement();\n    }\n\n    // Нужен переход\n    if (this.props.activeView !== prevProps.activeView) {\n      let pageYOffset = this.props.scroll.getScroll().y;\n      const firstLayerId = [].concat(prevProps.children)\n        .map((view) => getNavId(view.props, warn))\n        .find((id) => id === prevProps.activeView || id === this.props.activeView);\n      const isBack = firstLayerId === this.props.activeView;\n\n      this.blurActiveElement();\n\n      const nextView = this.props.activeView;\n      const prevView = prevProps.activeView;\n\n      this.setState({\n        scrolls: {\n          ...this.state.scrolls,\n          [prevProps.activeView]: pageYOffset,\n        },\n        transition: true,\n        activeView: null,\n        nextView,\n        prevView,\n        visibleViews: [nextView, prevView],\n        isBack,\n      });\n    }\n\n    // Начался переход\n    if (!prevState.transition && this.state.transition) {\n      const prevViewElement = this.viewNodes[this.state.prevView];\n      const nextViewElement = this.viewNodes[this.state.nextView];\n      const setPanelScroll = (e: HTMLElement, scroll: number) => {\n        // eslint-disable-next-line no-restricted-properties\n        const pan: HTMLElement | null = e.querySelector('[data-vkui-active-panel=true]');\n        pan && (pan.scrollTop = scroll);\n      };\n\n      setPanelScroll(prevViewElement, this.state.scrolls[this.state.prevView]);\n\n      if (this.state.isBack) {\n        setPanelScroll(nextViewElement, this.state.scrolls[this.state.nextView]);\n      }\n      this.waitAnimationFinish(this.state.isBack ? prevViewElement : nextViewElement, this.onAnimationEnd);\n    }\n  }\n\n  shouldDisableTransitionMotion(): boolean {\n    return this.props.configProvider.transitionMotionEnabled === false ||\n      !this.props.splitCol.animate;\n  }\n\n  waitAnimationFinish(elem: HTMLElement, eventHandler: AnimationEndCallback) {\n    if (this.shouldDisableTransitionMotion()) {\n      eventHandler();\n      return;\n    }\n\n    if (animationEvent.supported) {\n      elem.removeEventListener(animationEvent.name, eventHandler);\n      elem.addEventListener(animationEvent.name, eventHandler);\n    } else {\n      clearTimeout(this.animationFinishTimeout);\n      this.animationFinishTimeout = setTimeout(eventHandler.bind(this), this.props.platform === ANDROID || this.props.platform === VKCOM ? 300 : 600);\n    }\n  }\n\n  onAnimationEnd: AnimationEndCallback = (e?: AnimationEvent) => {\n    if (!e || [\n      'vkui-root-android-animation-hide-back',\n      'vkui-root-android-animation-show-forward',\n      'vkui-root-ios-animation-hide-back',\n      'vkui-root-ios-animation-show-forward',\n    ].includes(e.animationName)) {\n      const isBack = this.state.isBack;\n      const prevView = this.state.prevView;\n      const nextView = this.state.nextView;\n      this.setState({\n        activeView: nextView,\n        prevView: null,\n        nextView: null,\n        visibleViews: [nextView],\n        transition: false,\n        isBack: undefined,\n      }, () => {\n        this.props.scroll.scrollTo(0, isBack ? this.state.scrolls[this.state.activeView] : 0);\n        this.props.onTransition && this.props.onTransition({ isBack, from: prevView, to: nextView });\n      });\n    }\n  };\n\n  blurActiveElement() {\n    if (canUseDOM && this.document.activeElement) {\n      (this.document.activeElement as HTMLElement).blur();\n    }\n  }\n\n  render() {\n    const {\n      popout, modal, platform,\n      splitCol, configProvider, activeView: _1, onTransition,\n      window, document, scroll,\n      ...restProps\n    } = this.props;\n    const { transition, isBack, prevView, activeView, nextView } = this.state;\n\n    const Views = React.Children.toArray(this.props.children).filter((view: ReactElement) => {\n      return this.state.visibleViews.includes(getNavId(view.props, warn));\n    });\n\n    const baseClassName = getClassName('Root', platform);\n    const disableAnimation = this.shouldDisableTransitionMotion();\n\n    return (\n      <div {...restProps} vkuiClass={classNames(baseClassName, {\n        'Root--transition': !disableAnimation && transition,\n        'Root--no-motion': disableAnimation,\n      })}>\n        {Views.map((view: ReactElement) => {\n          const viewId = getNavId(view.props, warn);\n          return (\n            <div key={viewId} ref={(e) => this.viewNodes[viewId] = e} vkuiClass={classNames('Root__view', {\n              'Root__view--hide-back': viewId === prevView && isBack,\n              'Root__view--hide-forward': viewId === prevView && !isBack,\n              'Root__view--show-back': viewId === nextView && isBack,\n              'Root__view--show-forward': viewId === nextView && !isBack,\n              'Root__view--active': viewId === activeView,\n            })}>\n              {view}\n            </div>\n          );\n        })}\n        <AppRootPortal>\n          {!!popout && <div vkuiClass=\"Root__popout\">{popout}</div>}\n          {!!modal && <div vkuiClass=\"Root__modal\">{modal}</div>}\n        </AppRootPortal>\n      </div>\n    );\n  }\n}\n\nexport default withContext(withContext(withContext(\n  withPlatform(withDOM<RootProps>(Root)),\n  SplitColContext,\n  'splitCol',\n), ConfigProviderContext, 'configProvider'), ScrollContext, 'scroll');\n"]},"metadata":{},"sourceType":"module"}