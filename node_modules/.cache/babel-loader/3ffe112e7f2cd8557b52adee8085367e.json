{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\n\nvar CustomStorage = /*#__PURE__*/function () {\n  function CustomStorage() {\n    var _this = this;\n\n    _classCallCheck(this, CustomStorage);\n\n    _defineProperty(this, \"data\", {});\n\n    _defineProperty(this, \"getItem\", function (key) {\n      return _this.data.hasOwnProperty(key) ? _this.data[key] : null;\n    });\n\n    _defineProperty(this, \"keys\", function () {\n      return Object.keys(_this.data);\n    });\n  }\n\n  _createClass(CustomStorage, [{\n    key: \"setItem\",\n    value: function setItem(key, val) {\n      this.data[key] = String(val);\n    }\n  }, {\n    key: \"removeItem\",\n    value: function removeItem(id) {\n      delete this.data[id];\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      this.data = {};\n    }\n  }, {\n    key: \"key\",\n    value: function key(index) {\n      return Object.keys(this.data)[index];\n    }\n  }, {\n    key: \"length\",\n    get: function get() {\n      return Object.keys(this.data).length;\n    }\n  }]);\n\n  return CustomStorage;\n}();\n\nvar dummyKey = 'vk-ls-dummy';\nvar dummyContent = 'test';\nvar ls;\n\nfunction getLocalStorage() {\n  if (ls) {\n    return ls;\n  }\n\n  try {\n    // Проверяем, нет ли в FF или Safari cross domain security restrictions\n    window.localStorage.setItem(dummyKey, dummyContent);\n\n    if (dummyContent !== window.localStorage.getItem(dummyKey)) {\n      throw new Error('localStorage is broken');\n    }\n\n    window.localStorage.removeItem(dummyKey);\n    ls = window.localStorage;\n  } catch (e) {\n    ls = new CustomStorage();\n  }\n\n  return ls;\n}\n/**\n * Обертка над localStorage для кода, который может использоваться на других сайтах\n * Firefox блокирует доступ к localStorage для скриптов с других доменов\n */\n\n\nexport var localStorage = {\n  setItem: function setItem(key, val) {\n    return getLocalStorage().setItem(key, val);\n  },\n  getItem: function getItem(key) {\n    return getLocalStorage().getItem(key);\n  },\n  removeItem: function removeItem(key) {\n    return getLocalStorage().removeItem(key);\n  },\n  clear: function clear() {\n    return getLocalStorage().clear();\n  },\n  length: function length() {\n    return getLocalStorage().length;\n  },\n  key: function key(index) {\n    return getLocalStorage().key(index);\n  },\n  keys: function keys() {\n    var storage = getLocalStorage();\n\n    if (storage instanceof CustomStorage) {\n      return storage.keys();\n    } else {\n      return Object.keys(storage);\n    }\n  },\n  getPrefixedKeys: function getPrefixedKeys(prefix) {\n    return localStorage.keys().filter(function (key) {\n      return key.startsWith(prefix);\n    });\n  }\n};\nvar sessionStorageCache;\n\nfunction getSessionStorage() {\n  if (sessionStorageCache) {\n    return sessionStorageCache;\n  }\n\n  try {\n    // Проверяем, нет ли в FF или Safari cross domain security restrictions\n    window.sessionStorage.setItem(dummyKey, dummyContent);\n\n    if (dummyContent !== window.sessionStorage.getItem(dummyKey)) {\n      throw new Error('sessionStorage is broken');\n    }\n\n    window.sessionStorage.removeItem(dummyKey);\n    sessionStorageCache = window.sessionStorage;\n  } catch (e) {\n    sessionStorageCache = new CustomStorage();\n  }\n\n  return sessionStorageCache;\n}\n\nexport var sessionStorage = {\n  setItem: function setItem(key, val) {\n    return getSessionStorage().setItem(key, val);\n  },\n  getItem: function getItem(key) {\n    return getSessionStorage().getItem(key);\n  },\n  removeItem: function removeItem(key) {\n    return getSessionStorage().removeItem(key);\n  },\n  clear: function clear() {\n    return getSessionStorage().clear();\n  },\n  length: function length() {\n    return getSessionStorage().length;\n  },\n  key: function key(index) {\n    return getSessionStorage().key(index);\n  },\n  keys: function keys() {\n    var storage = getSessionStorage();\n\n    if (storage instanceof CustomStorage) {\n      return storage.keys();\n    } else {\n      return Object.keys(storage);\n    }\n  },\n  getPrefixedKeys: function getPrefixedKeys(prefix) {\n    return sessionStorage.keys().filter(function (key) {\n      return key.startsWith(prefix);\n    });\n  }\n};","map":{"version":3,"sources":["../../src/storage.ts"],"names":["CustomStorage","key","val","String","id","Object","index","dummyKey","dummyContent","window","ls","localStorage","setItem","getLocalStorage","getItem","removeItem","clear","length","keys","storage","getPrefixedKeys","sessionStorageCache","sessionStorage","getSessionStorage"],"mappings":"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","sourcesContent":["import { Dictionary } from './types';\n\nclass CustomStorage {\n  private data: Dictionary<string> = {};\n\n  public setItem(key: string, val: string) {\n    this.data[key] = String(val);\n  };\n\n  public getItem = (key: string) => this.data.hasOwnProperty(key) ? this.data[key] : null;\n\n  public removeItem(id: string) {\n    delete this.data[id];\n  };\n\n  public clear() {\n    this.data = {};\n  }\n\n  public get length() {\n    return Object.keys(this.data).length;\n  };\n\n  public key(index: number): string | null {\n    return Object.keys(this.data)[index];\n  }\n\n  public keys = (): string[] => Object.keys(this.data);\n}\n\nconst dummyKey = 'vk-ls-dummy';\nconst dummyContent = 'test';\n\nlet ls: CustomStorage | Storage;\n\nfunction getLocalStorage() {\n  if (ls) {\n    return ls;\n  }\n  try {\n    // Проверяем, нет ли в FF или Safari cross domain security restrictions\n    window.localStorage.setItem(dummyKey, dummyContent);\n    if (dummyContent !== window.localStorage.getItem(dummyKey)) {\n      throw new Error('localStorage is broken');\n    }\n    window.localStorage.removeItem(dummyKey);\n    ls = window.localStorage;\n  } catch (e) {\n    ls = new CustomStorage();\n  }\n  return ls;\n}\n\n/**\n * Обертка над localStorage для кода, который может использоваться на других сайтах\n * Firefox блокирует доступ к localStorage для скриптов с других доменов\n */\nexport const localStorage = {\n  setItem: (key: string, val: string) => getLocalStorage().setItem(key, val),\n  getItem: (key: string) => getLocalStorage().getItem(key),\n  removeItem: (key: string) => getLocalStorage().removeItem(key),\n  clear: () => getLocalStorage().clear(),\n  length: () => getLocalStorage().length,\n  key: (index: number) => getLocalStorage().key(index),\n  keys(): string[] {\n    const storage = getLocalStorage();\n    if (storage instanceof CustomStorage) {\n      return storage.keys();\n    } else {\n      return Object.keys(storage);\n    }\n  },\n  getPrefixedKeys: (prefix: string): string[] => localStorage.keys().filter((key) => key.startsWith(prefix)),\n};\n\nlet sessionStorageCache: CustomStorage | Storage;\n\nfunction getSessionStorage() {\n  if (sessionStorageCache) {\n    return sessionStorageCache;\n  }\n  try {\n    // Проверяем, нет ли в FF или Safari cross domain security restrictions\n    window.sessionStorage.setItem(dummyKey, dummyContent);\n    if (dummyContent !== window.sessionStorage.getItem(dummyKey)) {\n      throw new Error('sessionStorage is broken');\n    }\n    window.sessionStorage.removeItem(dummyKey);\n    sessionStorageCache = window.sessionStorage;\n  } catch (e) {\n    sessionStorageCache = new CustomStorage();\n  }\n  return sessionStorageCache;\n}\n\nexport const sessionStorage = {\n  setItem: (key: string, val: string) => getSessionStorage().setItem(key, val),\n  getItem: (key: string) => getSessionStorage().getItem(key),\n  removeItem: (key: string) => getSessionStorage().removeItem(key),\n  clear: () => getSessionStorage().clear(),\n  length: () => getSessionStorage().length,\n  key: (index: number) => getSessionStorage().key(index),\n  keys(): string[] {\n    const storage = getSessionStorage();\n    if (storage instanceof CustomStorage) {\n      return storage.keys();\n    } else {\n      return Object.keys(storage);\n    }\n  },\n  getPrefixedKeys: (prefix: string): string[] => sessionStorage.keys().filter((key) => key.startsWith(prefix)),\n};\n"]},"metadata":{},"sourceType":"module"}