{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nimport { createScopedElement } from \"../../lib/jsxRuntime\";\nimport { useMemo, useRef, useState } from 'react';\nimport { useDOM } from \"../../lib/dom\";\nimport { classNames } from \"../../lib/classNames\";\nimport { AppRootContext } from \"./AppRootContext\";\nimport { withAdaptivity, SizeType } from \"../../hoc/withAdaptivity\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport { classScopingMode } from \"../../lib/classScopingMode\";\nimport { IconSettingsProvider } from '@vkontakte/icons';\nimport { elementScrollController, globalScrollController, ScrollContext } from \"./ScrollContext\";\nimport { noop } from \"../../lib/utils\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nimport { useKeyboardInputTracker } from \"../../hooks/useKeyboardInputTracker\"; // Используйте classList, но будьте осторожны\n\n/* eslint-disable no-restricted-properties */\n\nvar warn = warnOnce('AppRoot');\nexport var AppRoot = withAdaptivity(function (_ref) {\n  var children = _ref.children,\n      _mode = _ref.mode,\n      _embedded = _ref.embedded,\n      sizeX = _ref.sizeX,\n      hasMouse = _ref.hasMouse,\n      _ref$noLegacyClasses = _ref.noLegacyClasses,\n      noLegacyClasses = _ref$noLegacyClasses === void 0 ? false : _ref$noLegacyClasses,\n      _ref$scroll = _ref.scroll,\n      scroll = _ref$scroll === void 0 ? 'global' : _ref$scroll,\n      props = _objectWithoutProperties(_ref, [\"children\", \"mode\", \"embedded\", \"sizeX\", \"hasMouse\", \"noLegacyClasses\", \"scroll\"]); // normalize mode\n\n\n  var mode = _mode || (_embedded ? 'embedded' : 'full');\n  var isKeyboardInputActive = useKeyboardInputTracker();\n  var rootRef = useRef();\n\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      portalRoot = _useState2[0],\n      setPortalRoot = _useState2[1];\n\n  var _useDOM = useDOM(),\n      window = _useDOM.window,\n      document = _useDOM.document;\n\n  var initialized = useRef(false);\n\n  if (!initialized.current) {\n    if (window && mode === 'full') {\n      document.documentElement.classList.add('vkui');\n    }\n\n    classScopingMode.noConflict = noLegacyClasses;\n    initialized.current = true;\n  }\n\n  if (process.env.NODE_ENV === 'development') {\n    if (scroll !== 'global' && mode !== 'embedded') {\n      warn('Scroll modes only supported in embedded mode');\n    }\n\n    if (_mode && _embedded) {\n      warn(\"mode=\\\"\".concat(mode, \"\\\" overrides embedded\"));\n    }\n  } // setup portal\n\n\n  useIsomorphicLayoutEffect(function () {\n    if (mode === 'full') {\n      return noop;\n    }\n\n    var portal = document.createElement('div');\n    portal.classList.add('vkui__portal-root');\n    document.body.appendChild(portal);\n    setPortalRoot(portal);\n    return function () {\n      return portal.parentElement.removeChild(portal);\n    };\n  }, []); // setup root classes\n\n  useIsomorphicLayoutEffect(function () {\n    var _parent$classList;\n\n    if (mode === 'partial') {\n      return noop;\n    }\n\n    var parent = rootRef.current.parentElement;\n    var classes = ['vkui__root'].concat(mode === 'embedded' ? 'vkui__root--embedded' : []);\n\n    (_parent$classList = parent.classList).add.apply(_parent$classList, _toConsumableArray(classes));\n\n    return function () {\n      var _parent$classList2;\n\n      (_parent$classList2 = parent.classList).remove.apply(_parent$classList2, _toConsumableArray(classes));\n\n      if (mode === 'full') {\n        document.documentElement.classList.remove('vkui');\n      }\n    };\n  }, []); // adaptivity handler\n\n  useIsomorphicLayoutEffect(function () {\n    if (mode === 'partial' || sizeX !== SizeType.REGULAR) {\n      return noop;\n    }\n\n    var container = mode === 'embedded' ? rootRef.current.parentElement : document.body;\n    container.classList.add('vkui--sizeX-regular');\n    return function () {\n      return container.classList.remove('vkui--sizeX-regular');\n    };\n  }, [sizeX]);\n  var scrollController = useMemo(function () {\n    return scroll === 'contain' ? elementScrollController(rootRef) : globalScrollController(window, document);\n  }, [scroll]);\n  var content = createScopedElement(AppRootContext.Provider, {\n    value: {\n      appRoot: rootRef,\n      portalRoot: portalRoot,\n      embedded: mode === 'embedded'\n    }\n  }, createScopedElement(ScrollContext.Provider, {\n    value: scrollController\n  }, createScopedElement(IconSettingsProvider, {\n    classPrefix: \"vkui\",\n    globalClasses: !noLegacyClasses\n  }, children)));\n  return mode === 'partial' ? content : createScopedElement(\"div\", _extends({\n    ref: rootRef,\n    vkuiClass: classNames('AppRoot', {\n      'AppRoot--no-mouse': !hasMouse,\n      'AppRoot--keyboard-input': isKeyboardInputActive\n    })\n  }, props), content);\n}, {\n  sizeX: true,\n  hasMouse: true\n});\nexport default AppRoot;","map":{"version":3,"sources":["../../../src/components/AppRoot/AppRoot.tsx"],"names":["warn","warnOnce","AppRoot","withAdaptivity","children","mode","_mode","embedded","_embedded","sizeX","hasMouse","noLegacyClasses","scroll","props","isKeyboardInputActive","useKeyboardInputTracker","rootRef","useRef","portalRoot","setPortalRoot","useState","window","document","useDOM","initialized","classScopingMode","process","useIsomorphicLayoutEffect","portal","parent","classes","SizeType","container","scrollController","useMemo","elementScrollController","globalScrollController","content","appRoot","classNames"],"mappings":"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","sourcesContent":["import { FC, HTMLAttributes, useMemo, useRef, useState } from 'react';\nimport { useDOM } from '../../lib/dom';\nimport { classNames } from '../../lib/classNames';\nimport { AppRootContext } from './AppRootContext';\nimport { withAdaptivity, SizeType, AdaptivityProps } from '../../hoc/withAdaptivity';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { classScopingMode } from '../../lib/classScopingMode';\nimport { IconSettingsProvider } from '@vkontakte/icons';\nimport { elementScrollController, globalScrollController, ScrollContext, ScrollContextInterface } from './ScrollContext';\nimport { noop } from '../../lib/utils';\nimport { warnOnce } from '../../lib/warnOnce';\nimport { useKeyboardInputTracker } from '../../hooks/useKeyboardInputTracker';\n\n// Используйте classList, но будьте осторожны\n/* eslint-disable no-restricted-properties */\n\nexport interface AppRootProps extends HTMLAttributes<HTMLDivElement>, AdaptivityProps {\n  /** @deprecated Use mode=\"embedded\" */\n  embedded?: boolean;\n  /** Режим встраивания */\n  mode?: 'partial' | 'embedded' | 'full';\n  window?: Window;\n  /** Убирает классы без префикса (.Button) */\n  noLegacyClasses?: boolean;\n  scroll?: 'global' | 'contain';\n}\n\nconst warn = warnOnce('AppRoot');\nexport const AppRoot: FC<AppRootProps> = withAdaptivity(({\n  children, mode: _mode, embedded: _embedded, sizeX, hasMouse, noLegacyClasses = false, scroll = 'global',\n  ...props\n}: AppRootProps) => {\n  // normalize mode\n  const mode = _mode || (_embedded ? 'embedded' : 'full');\n  const isKeyboardInputActive = useKeyboardInputTracker();\n  const rootRef = useRef<HTMLDivElement>();\n  const [portalRoot, setPortalRoot] = useState<HTMLDivElement>(null);\n  const { window, document } = useDOM();\n\n  const initialized = useRef(false);\n  if (!initialized.current) {\n    if (window && mode === 'full') {\n      document.documentElement.classList.add('vkui');\n    }\n    classScopingMode.noConflict = noLegacyClasses;\n    initialized.current = true;\n  }\n\n  if (process.env.NODE_ENV === 'development') {\n    if (scroll !== 'global' && mode !== 'embedded') {\n      warn('Scroll modes only supported in embedded mode');\n    }\n    if (_mode && _embedded) {\n      warn(`mode=\"${mode}\" overrides embedded`);\n    }\n  }\n\n  // setup portal\n  useIsomorphicLayoutEffect(() => {\n    if (mode === 'full') {\n      return noop;\n    }\n\n    const portal = document.createElement('div');\n    portal.classList.add('vkui__portal-root');\n    document.body.appendChild(portal);\n    setPortalRoot(portal);\n    return () => portal.parentElement.removeChild(portal);\n  }, []);\n\n  // setup root classes\n  useIsomorphicLayoutEffect(() => {\n    if (mode === 'partial') {\n      return noop;\n    }\n\n    const parent = rootRef.current.parentElement;\n    const classes = ['vkui__root'].concat(mode === 'embedded' ? 'vkui__root--embedded' : []);\n    parent.classList.add(...classes);\n\n    return () => {\n      parent.classList.remove(...classes);\n      if (mode === 'full') {\n        document.documentElement.classList.remove('vkui');\n      }\n    };\n  }, []);\n\n  // adaptivity handler\n  useIsomorphicLayoutEffect(() => {\n    if (mode === 'partial' || sizeX !== SizeType.REGULAR) {\n      return noop;\n    }\n    const container = mode === 'embedded' ? rootRef.current.parentElement : document.body;\n    container.classList.add('vkui--sizeX-regular');\n    return () => container.classList.remove('vkui--sizeX-regular');\n  }, [sizeX]);\n\n  const scrollController = useMemo<ScrollContextInterface>(\n    () => scroll === 'contain' ? elementScrollController(rootRef) : globalScrollController(window, document),\n    [scroll]);\n\n  const content = (\n    <AppRootContext.Provider value={{\n      appRoot: rootRef,\n      portalRoot: portalRoot,\n      embedded: mode === 'embedded',\n    }}>\n      <ScrollContext.Provider value={scrollController}>\n        <IconSettingsProvider classPrefix=\"vkui\" globalClasses={!noLegacyClasses}>\n          {children}\n        </IconSettingsProvider>\n      </ScrollContext.Provider>\n    </AppRootContext.Provider>\n  );\n\n  return mode === 'partial' ? content : (\n    <div ref={rootRef} vkuiClass={classNames('AppRoot', {\n      'AppRoot--no-mouse': !hasMouse,\n      'AppRoot--keyboard-input': isKeyboardInputActive,\n    })} {...props}>\n      {content}\n    </div>\n  );\n}, {\n  sizeX: true,\n  hasMouse: true,\n});\n\nexport default AppRoot;\n"]},"metadata":{},"sourceType":"module"}