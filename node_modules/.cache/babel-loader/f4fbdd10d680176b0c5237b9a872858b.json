{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _createSuper from \"@babel/runtime/helpers/createSuper\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport { createScopedElement } from \"../../lib/jsxRuntime\";\nimport React, { createRef } from 'react';\nimport { withDOM } from \"../../lib/dom\";\nimport { multiRef, setRef } from \"../../lib/utils\";\n\nvar CustomScrollView = /*#__PURE__*/function (_React$Component) {\n  _inherits(CustomScrollView, _React$Component);\n\n  var _super = _createSuper(CustomScrollView);\n\n  function CustomScrollView() {\n    var _this;\n\n    _classCallCheck(this, CustomScrollView);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"ratio\", NaN);\n\n    _defineProperty(_assertThisInitialized(_this), \"lastTrackerTop\", 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"clientHeight\", 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"trackerHeight\", 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"scrollHeight\", 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"transformProp\", '');\n\n    _defineProperty(_assertThisInitialized(_this), \"startY\", 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"trackerTop\", 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"box\", multiRef(function (e) {\n      return setRef(e, _this.props.boxRef);\n    }));\n\n    _defineProperty(_assertThisInitialized(_this), \"barY\", /*#__PURE__*/createRef());\n\n    _defineProperty(_assertThisInitialized(_this), \"trackerY\", /*#__PURE__*/createRef());\n\n    _defineProperty(_assertThisInitialized(_this), \"resize\", function () {\n      var clientHeight = _this.box.current.clientHeight;\n      var scrollHeight = _this.box.current.scrollHeight;\n      var ratio = clientHeight / scrollHeight;\n      var trackerHeight = Math.max(clientHeight * ratio, 40);\n      _this.ratio = ratio;\n      _this.clientHeight = clientHeight;\n      _this.scrollHeight = scrollHeight;\n      _this.trackerHeight = trackerHeight;\n\n      if (ratio >= 1) {\n        _this.barY.current.style.display = 'none';\n      } else {\n        _this.barY.current.style.display = '';\n        _this.trackerY.current.style.height = \"\".concat(trackerHeight, \"px\");\n\n        _this.setTrackerPositionFromScroll(_this.box.current.scrollTop);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"scroll\", function () {\n      if (_this.ratio >= 1) {\n        return;\n      }\n\n      _this.setTrackerPositionFromScroll(_this.box.current.scrollTop);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onDragStart\", function (e) {\n      e.preventDefault();\n      _this.startY = e.clientY;\n      _this.trackerTop = _this.lastTrackerTop;\n\n      _this.props.document.addEventListener('mousemove', _this.onMove);\n\n      _this.props.document.addEventListener('mouseup', _this.onUp);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onMove\", function (e) {\n      e.preventDefault();\n      var diff = e.clientY - _this.startY;\n      var position = Math.min(Math.max(_this.trackerTop + diff, 0), _this.clientHeight - _this.trackerHeight);\n\n      _this.setScrollPositionFromTracker(position);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onUp\", function (e) {\n      e.preventDefault();\n\n      _this.props.document.removeEventListener('mousemove', _this.onMove);\n\n      _this.props.document.removeEventListener('mouseup', _this.onUp);\n    });\n\n    return _this;\n  }\n\n  _createClass(CustomScrollView, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.chooseTransformProp();\n      this.resize();\n\n      if (this.props.windowResize) {\n        this.props.window.addEventListener('resize', this.resize);\n      }\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      this.resize();\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.props.window.removeEventListener('resize', this.resize);\n    }\n  }, {\n    key: \"chooseTransformProp\",\n    value: function chooseTransformProp() {\n      var style = this.trackerY.current.style;\n      var prop = '';\n\n      if ('transform' in style) {\n        prop = 'transform';\n      } else if ('webkitTransform' in style) {\n        prop = 'webkitTransform';\n      }\n\n      this.transformProp = prop;\n    }\n  }, {\n    key: \"setTrackerPosition\",\n    value: function setTrackerPosition(scrollTop) {\n      this.lastTrackerTop = scrollTop;\n      this.trackerY.current.style[this.transformProp] = \"translate(0, \".concat(scrollTop, \"px)\");\n    }\n  }, {\n    key: \"setTrackerPositionFromScroll\",\n    value: function setTrackerPositionFromScroll(scrollTop) {\n      var progress = scrollTop / (this.scrollHeight - this.clientHeight);\n      this.setTrackerPosition((this.clientHeight - this.trackerHeight) * progress);\n    }\n  }, {\n    key: \"setScrollPositionFromTracker\",\n    value: function setScrollPositionFromTracker(trackerTop) {\n      var progress = trackerTop / (this.clientHeight - this.trackerHeight);\n      this.box.current.scrollTop = (this.scrollHeight - this.clientHeight) * progress;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return createScopedElement(\"div\", {\n        vkuiClass: \"CustomScrollView\"\n      }, createScopedElement(\"div\", {\n        vkuiClass: \"CustomScrollView__barY\",\n        ref: this.barY\n      }, createScopedElement(\"div\", {\n        vkuiClass: \"CustomScrollView__trackerY\",\n        ref: this.trackerY,\n        onMouseDown: this.onDragStart\n      })), createScopedElement(\"div\", {\n        vkuiClass: \"CustomScrollView__box\",\n        tabIndex: -1,\n        ref: this.box,\n        onScroll: this.scroll\n      }, this.props.children));\n    }\n  }]);\n\n  return CustomScrollView;\n}(React.Component);\n\nexport default withDOM(CustomScrollView);","map":{"version":3,"sources":["../../../src/components/CustomScrollView/CustomScrollView.tsx"],"names":["CustomScrollView","React","Component","NaN","multiRef","setRef","createRef","style","prop","clientHeight","scrollHeight","ratio","trackerHeight","Math","scrollTop","progress","trackerTop","e","diff","position","barY","onDragStart","scroll","withDOM"],"mappings":";;;;;;;AAAA,OAAA,KAAA,IAAA,SAAA,QAAA,OAAA;AACA,SAAA,OAAA,QAAA,eAAA;AACA,SAAA,QAAA,EAAA,MAAA,QAAA,iBAAA;;IAOMA,gB;;;;;;;;;;;;;;;;4DACYG,G;;qEACS,C;;mEACF,C;;oEACC,C;;mEACD,C;;oEACC,E;;6DAEP,C;;iEACI,C;;0DAEEC,QAAQ,CAAiB,UAAA,CAAA,EAAA;AAAA,aAAOC,MAAM,CAAA,CAAA,EAAI,KAAA,CAAA,KAAA,CAAjB,MAAa,CAAb;AAAjB,KAAA,C;;wEACPC,SAAS,E;;4EACLA,SAAS,E;;6DAiC5B,YAAM;AACb,UAAMG,YAAY,GAAG,KAAA,CAAA,GAAA,CAAA,OAAA,CAArB,YAAA;AACA,UAAMC,YAAY,GAAG,KAAA,CAAA,GAAA,CAAA,OAAA,CAArB,YAAA;AACA,UAAIC,KAAK,GAAGF,YAAY,GAAxB,YAAA;AACA,UAAIG,aAAa,GAAGC,IAAI,CAAJA,GAAAA,CAASJ,YAAY,GAArBI,KAAAA,EAApB,EAAoBA,CAApB;AAEA,MAAA,KAAA,CAAA,KAAA,GAAA,KAAA;AACA,MAAA,KAAA,CAAA,YAAA,GAAA,YAAA;AACA,MAAA,KAAA,CAAA,YAAA,GAAA,YAAA;AACA,MAAA,KAAA,CAAA,aAAA,GAAA,aAAA;;AAEA,UAAIF,KAAK,IAAT,CAAA,EAAgB;AACd,QAAA,KAAA,CAAA,IAAA,CAAA,OAAA,CAAA,KAAA,CAAA,OAAA,GAAA,MAAA;AADF,OAAA,MAEO;AACL,QAAA,KAAA,CAAA,IAAA,CAAA,OAAA,CAAA,KAAA,CAAA,OAAA,GAAA,EAAA;AACA,QAAA,KAAA,CAAA,QAAA,CAAA,OAAA,CAAA,KAAA,CAAA,MAAA,GAAA,GAAA,MAAA,CAAA,aAAA,EAAA,IAAA,CAAA;;AAEA,QAAA,KAAA,CAAA,4BAAA,CAAkC,KAAA,CAAA,GAAA,CAAA,OAAA,CAAlC,SAAA;AACD;;;6DAGM,YAAM;AACb,UAAI,KAAA,CAAA,KAAA,IAAJ,CAAA,EAAqB;AACnB;AACD;;AAED,MAAA,KAAA,CAAA,4BAAA,CAAkC,KAAA,CAAA,GAAA,CAAA,OAAA,CAAlC,SAAA;;;kEAkBY,UAAA,CAAA,EAAyB;AACrCM,MAAAA,CAAC,CAADA,cAAAA;AACA,MAAA,KAAA,CAAA,MAAA,GAAcA,CAAC,CAAf,OAAA;AACA,MAAA,KAAA,CAAA,UAAA,GAAkB,KAAA,CAAlB,cAAA;;AAEA,MAAA,KAAA,CAAA,KAAA,CAAA,QAAA,CAAA,gBAAA,CAAA,WAAA,EAAkD,KAAA,CAAlD,MAAA;;AACA,MAAA,KAAA,CAAA,KAAA,CAAA,QAAA,CAAA,gBAAA,CAAA,SAAA,EAAgD,KAAA,CAAhD,IAAA;;;6DAGO,UAAA,CAAA,EAAmB;AAC1BA,MAAAA,CAAC,CAADA,cAAAA;AACA,UAAMC,IAAI,GAAGD,CAAC,CAADA,OAAAA,GAAY,KAAA,CAAzB,MAAA;AACA,UAAME,QAAQ,GAAGN,IAAI,CAAJA,GAAAA,CAASA,IAAI,CAAJA,GAAAA,CAAS,KAAA,CAAA,UAAA,GAATA,IAAAA,EAATA,CAASA,CAATA,EAA8C,KAAA,CAAA,YAAA,GAAoB,KAAA,CAAnF,aAAiBA,CAAjB;;AAEA,MAAA,KAAA,CAAA,4BAAA,CAAA,QAAA;;;2DAGK,UAAA,CAAA,EAAmB;AACxBI,MAAAA,CAAC,CAADA,cAAAA;;AACA,MAAA,KAAA,CAAA,KAAA,CAAA,QAAA,CAAA,mBAAA,CAAA,WAAA,EAAqD,KAAA,CAArD,MAAA;;AACA,MAAA,KAAA,CAAA,KAAA,CAAA,QAAA,CAAA,mBAAA,CAAA,SAAA,EAAmD,KAAA,CAAnD,IAAA;;;;;;;;wCA/FkB;AAClB,WAAA,mBAAA;AAEA,WAAA,MAAA;;AAEA,UAAI,KAAA,KAAA,CAAJ,YAAA,EAA6B;AAC3B,aAAA,KAAA,CAAA,MAAA,CAAA,gBAAA,CAAA,QAAA,EAA6C,KAA7C,MAAA;AACD;AACF;;;yCAEoB;AACnB,WAAA,MAAA;AACD;;;2CAEsB;AACrB,WAAA,KAAA,CAAA,MAAA,CAAA,mBAAA,CAAA,QAAA,EAAgD,KAAhD,MAAA;AACD;;;0CAEqB;AACpB,UAAIV,KAAK,GAAG,KAAA,QAAA,CAAA,OAAA,CAAZ,KAAA;AACA,UAAIC,IAAI,GAAR,EAAA;;AAEA,UAAI,eAAJ,KAAA,EAA0B;AACxBA,QAAAA,IAAI,GAAJA,WAAAA;AADF,OAAA,MAEO,IAAI,qBAAJ,KAAA,EAAgC;AACrCA,QAAAA,IAAI,GAAJA,iBAAAA;AACD;;AAED,WAAA,aAAA,GAAA,IAAA;AACD;;;uCA+BkBM,S,EAAmB;AACpC,WAAA,cAAA,GAAA,SAAA;AACC,WAAA,QAAA,CAAA,OAAA,CAAD,KAAC,CAAoC,KAArC,aAAC,IAAD,gBAAA,MAAA,CAAA,SAAA,EAAA,KAAA,CAAC;AACF;;;iDAE4BA,S,EAAmB;AAC9C,UAAMC,QAAQ,GAAGD,SAAS,IAAI,KAAA,YAAA,GAAoB,KAAlD,YAA0B,CAA1B;AACA,WAAA,kBAAA,CAAwB,CAAC,KAAA,YAAA,GAAoB,KAArB,aAAA,IAAxB,QAAA;AACD;;;iDAE4BE,U,EAAoB;AAC/C,UAAMD,QAAQ,GAAGC,UAAU,IAAI,KAAA,YAAA,GAAoB,KAAnD,aAA2B,CAA3B;AACA,WAAA,GAAA,CAAA,OAAA,CAAA,SAAA,GAA6B,CAAC,KAAA,YAAA,GAAoB,KAArB,YAAA,IAA7B,QAAA;AACD;;;6BAyBQ;AACP,aAAO,mBAAA,CAAA,KAAA,EAAA;AAAK,QAAA,SAAS,EAAC;AAAf,OAAA,EACL,mBAAA,CAAA,KAAA,EAAA;AAAK,QAAA,SAAS,EAAd,wBAAA;AAAwC,QAAA,GAAG,EAAE,KAAKI;AAAlD,OAAA,EACE,mBAAA,CAAA,KAAA,EAAA;AAAK,QAAA,SAAS,EAAd,4BAAA;AAA4C,QAAA,GAAG,EAAE,KAAjD,QAAA;AAAgE,QAAA,WAAW,EAAE,KAAKC;AAAlF,OAAA,CADF,CADK,EAKL,mBAAA,CAAA,KAAA,EAAA;AAAK,QAAA,SAAS,EAAd,uBAAA;AAAuC,QAAA,QAAQ,EAAE,CAAjD,CAAA;AAAqD,QAAA,GAAG,EAAE,KAA1D,GAAA;AAAoE,QAAA,QAAQ,EAAE,KAAKC;AAAnF,OAAA,EACG,KAAA,KAAA,CANL,QAKE,CALK,CAAP;AASD;;;;EA3H4BrB,KAAK,CAACC,S;;AA8HrC,eAAeqB,OAAO,CAAtB,gBAAsB,CAAtB","sourcesContent":["import React, { createRef, Ref } from 'react';\nimport { DOMProps, withDOM } from '../../lib/dom';\nimport { multiRef, setRef } from '../../lib/utils';\n\ninterface Props extends DOMProps {\n  windowResize?: boolean;\n  boxRef: Ref<HTMLDivElement>;\n}\n\nclass CustomScrollView extends React.Component<Props> {\n  private ratio = NaN;\n  private lastTrackerTop = 0;\n  private clientHeight = 0;\n  private trackerHeight = 0;\n  private scrollHeight = 0;\n  private transformProp = '';\n\n  private startY = 0;\n  private trackerTop = 0;\n\n  private readonly box = multiRef<HTMLDivElement>((e) => setRef(e, this.props.boxRef));\n  private readonly barY = createRef<HTMLDivElement>();\n  private readonly trackerY = createRef<HTMLDivElement>();\n\n  componentDidMount() {\n    this.chooseTransformProp();\n\n    this.resize();\n\n    if (this.props.windowResize) {\n      this.props.window.addEventListener('resize', this.resize);\n    }\n  }\n\n  componentDidUpdate() {\n    this.resize();\n  }\n\n  componentWillUnmount() {\n    this.props.window.removeEventListener('resize', this.resize);\n  }\n\n  chooseTransformProp() {\n    let style = this.trackerY.current.style;\n    let prop = '';\n\n    if ('transform' in style) {\n      prop = 'transform';\n    } else if ('webkitTransform' in style) {\n      prop = 'webkitTransform';\n    }\n\n    this.transformProp = prop;\n  }\n\n  resize = () => {\n    const clientHeight = this.box.current.clientHeight;\n    const scrollHeight = this.box.current.scrollHeight;\n    let ratio = clientHeight / scrollHeight;\n    let trackerHeight = Math.max(clientHeight * ratio, 40);\n\n    this.ratio = ratio;\n    this.clientHeight = clientHeight;\n    this.scrollHeight = scrollHeight;\n    this.trackerHeight = trackerHeight;\n\n    if (ratio >= 1) {\n      this.barY.current.style.display = 'none';\n    } else {\n      this.barY.current.style.display = '';\n      this.trackerY.current.style.height = `${trackerHeight}px`;\n\n      this.setTrackerPositionFromScroll(this.box.current.scrollTop);\n    }\n  };\n\n  scroll = () => {\n    if (this.ratio >= 1) {\n      return;\n    }\n\n    this.setTrackerPositionFromScroll(this.box.current.scrollTop);\n  };\n\n  setTrackerPosition(scrollTop: number) {\n    this.lastTrackerTop = scrollTop;\n    (this.trackerY.current.style as any)[this.transformProp] = `translate(0, ${scrollTop}px)`;\n  }\n\n  setTrackerPositionFromScroll(scrollTop: number) {\n    const progress = scrollTop / (this.scrollHeight - this.clientHeight);\n    this.setTrackerPosition((this.clientHeight - this.trackerHeight) * progress);\n  }\n\n  setScrollPositionFromTracker(trackerTop: number) {\n    const progress = trackerTop / (this.clientHeight - this.trackerHeight);\n    this.box.current.scrollTop = (this.scrollHeight - this.clientHeight) * progress;\n  }\n\n  onDragStart = (e: React.MouseEvent) => {\n    e.preventDefault();\n    this.startY = e.clientY;\n    this.trackerTop = this.lastTrackerTop;\n\n    this.props.document.addEventListener('mousemove', this.onMove);\n    this.props.document.addEventListener('mouseup', this.onUp);\n  };\n\n  onMove = (e: MouseEvent) => {\n    e.preventDefault();\n    const diff = e.clientY - this.startY;\n    const position = Math.min(Math.max(this.trackerTop + diff, 0), this.clientHeight - this.trackerHeight);\n\n    this.setScrollPositionFromTracker(position);\n  };\n\n  onUp = (e: MouseEvent) => {\n    e.preventDefault();\n    this.props.document.removeEventListener('mousemove', this.onMove);\n    this.props.document.removeEventListener('mouseup', this.onUp);\n  };\n\n  render() {\n    return <div vkuiClass=\"CustomScrollView\">\n      <div vkuiClass=\"CustomScrollView__barY\" ref={this.barY}>\n        <div vkuiClass=\"CustomScrollView__trackerY\" ref={this.trackerY} onMouseDown={this.onDragStart} />\n      </div>\n\n      <div vkuiClass=\"CustomScrollView__box\" tabIndex={-1} ref={this.box} onScroll={this.scroll}>\n        {this.props.children}\n      </div>\n    </div>;\n  }\n}\n\nexport default withDOM(CustomScrollView);\n"]},"metadata":{},"sourceType":"module"}