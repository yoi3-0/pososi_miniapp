{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nimport { createScopedElement } from \"../../lib/jsxRuntime\";\nimport { useState, useCallback } from 'react';\nimport { classNames } from \"../../lib/classNames\";\nimport { withPlatform } from \"../../hoc/withPlatform\";\nimport { getClassName } from \"../../helpers/getClassName\";\nimport { Icon16SearchOutline, Icon16Clear, Icon24Cancel } from '@vkontakte/icons';\nimport { IOS, VKCOM } from \"../../lib/platform\";\nimport Touch from \"../Touch/Touch\";\nimport { noop } from \"../../lib/utils\";\nimport Text from \"../Typography/Text/Text\";\nimport Title from \"../Typography/Title/Title\";\nimport Separator from \"../Separator/Separator\";\nimport { useExternRef } from \"../../hooks/useExternRef\";\nimport { useEnsuredControl } from \"../../hooks/useEnsuredControl\";\n\nvar Search = function Search(_ref) {\n  var before = _ref.before,\n      className = _ref.className,\n      defaultValue = _ref.defaultValue,\n      placeholder = _ref.placeholder,\n      after = _ref.after,\n      getRef = _ref.getRef,\n      platform = _ref.platform,\n      icon = _ref.icon,\n      _ref$onIconClick = _ref.onIconClick,\n      onIconClick = _ref$onIconClick === void 0 ? noop : _ref$onIconClick,\n      style = _ref.style,\n      inputProps = _objectWithoutProperties(_ref, [\"before\", \"className\", \"defaultValue\", \"placeholder\", \"after\", \"getRef\", \"platform\", \"icon\", \"onIconClick\", \"style\"]);\n\n  var inputRef = useExternRef(getRef);\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      isFocused = _useState2[0],\n      setFocused = _useState2[1];\n\n  var _useEnsuredControl = useEnsuredControl(inputProps, {\n    defaultValue: defaultValue\n  }),\n      _useEnsuredControl2 = _slicedToArray(_useEnsuredControl, 2),\n      value = _useEnsuredControl2[0],\n      onChange = _useEnsuredControl2[1];\n\n  var onFocus = function onFocus(e) {\n    setFocused(true);\n    inputProps.onFocus && inputProps.onFocus(e);\n  };\n\n  var onBlur = function onBlur(e) {\n    setFocused(false);\n    inputProps.onBlur && inputProps.onBlur(e);\n  };\n\n  var onCancel = function onCancel() {\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    var nativeInputValueSetter = Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype, 'value').set;\n    nativeInputValueSetter.call(inputRef.current, '');\n    var ev2 = new Event('input', {\n      bubbles: true\n    });\n    inputRef.current.dispatchEvent(ev2);\n  };\n\n  var onIconClickStart = useCallback(function (e) {\n    return onIconClick(e.originalEvent);\n  }, [onIconClick]);\n  var onIconCancelClickStart = useCallback(function (e) {\n    e.originalEvent.preventDefault();\n    inputRef.current.focus();\n    onCancel();\n  }, [onCancel]);\n  return createScopedElement(\"div\", {\n    vkuiClass: classNames(getClassName('Search', platform), {\n      'Search--focused': isFocused,\n      'Search--has-value': !!value,\n      'Search--has-after': !!after,\n      'Search--has-icon': !!icon\n    }),\n    className: className,\n    style: style\n  }, createScopedElement(\"div\", {\n    vkuiClass: \"Search__in\"\n  }, createScopedElement(\"div\", {\n    vkuiClass: \"Search__width\"\n  }), createScopedElement(\"label\", {\n    vkuiClass: \"Search__control\"\n  }, createScopedElement(\"input\", _extends({\n    type: \"search\"\n  }, inputProps, {\n    ref: inputRef,\n    vkuiClass: \"Search__input\",\n    onFocus: onFocus,\n    onBlur: onBlur,\n    onChange: onChange,\n    value: value\n  })), platform === IOS && after && createScopedElement(\"div\", {\n    vkuiClass: \"Search__after-width\"\n  }, after), createScopedElement(\"div\", {\n    vkuiClass: \"Search__placeholder\"\n  }, createScopedElement(\"div\", {\n    vkuiClass: \"Search__placeholder-in\"\n  }, before, platform === VKCOM ? createScopedElement(Text, {\n    vkuiClass: \"Search__placeholder-text\",\n    weight: \"regular\"\n  }, placeholder) : createScopedElement(Title, {\n    vkuiClass: \"Search__placeholder-text\",\n    level: \"3\",\n    weight: \"regular\"\n  }, placeholder)), isFocused && platform === IOS && after && createScopedElement(\"div\", {\n    vkuiClass: \"Search__after-width\"\n  }, after))), createScopedElement(\"div\", {\n    vkuiClass: \"Search__after\",\n    onClick: onCancel\n  }, createScopedElement(\"div\", {\n    vkuiClass: \"Search__icons\"\n  }, icon && createScopedElement(Touch, {\n    onStart: onIconClickStart,\n    vkuiClass: \"Search__icon\"\n  }, icon), !!value && createScopedElement(Touch, {\n    onStart: onIconCancelClickStart,\n    vkuiClass: \"Search__icon\"\n  }, platform === VKCOM ? createScopedElement(Icon24Cancel, null) : createScopedElement(Icon16Clear, null))), platform === IOS && after && createScopedElement(\"div\", {\n    vkuiClass: \"Search__after-in\"\n  }, after))), platform === VKCOM && createScopedElement(Separator, {\n    vkuiClass: \"Search__separator\",\n    wide: true\n  }));\n};\n\nSearch.defaultProps = {\n  autoComplete: 'off',\n  defaultValue: '',\n  placeholder: 'Поиск',\n  after: 'Отмена',\n  before: createScopedElement(Icon16SearchOutline, null)\n};\nexport default withPlatform(Search);","map":{"version":3,"sources":["../../../src/components/Search/Search.tsx"],"names":["Search","before","className","defaultValue","placeholder","after","getRef","platform","icon","onIconClick","noop","style","inputProps","inputRef","useExternRef","isFocused","setFocused","useState","value","onChange","useEnsuredControl","onFocus","onBlur","onCancel","nativeInputValueSetter","Object","window","ev2","bubbles","onIconClickStart","useCallback","e","onIconCancelClickStart","classNames","getClassName","autoComplete","withPlatform"],"mappings":"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","sourcesContent":["import {\n  ReactNode,\n  FocusEvent,\n  InputHTMLAttributes,\n  FC,\n  useState,\n  useCallback,\n} from 'react';\nimport { classNames } from '../../lib/classNames';\nimport { withPlatform } from '../../hoc/withPlatform';\nimport { getClassName } from '../../helpers/getClassName';\nimport { Icon16SearchOutline, Icon16Clear, Icon24Cancel } from '@vkontakte/icons';\nimport { IOS, VKCOM } from '../../lib/platform';\nimport { HasPlatform, HasRef } from '../../types';\nimport Touch, { TouchEvent } from '../Touch/Touch';\nimport { VKUITouchEvent } from '../../lib/touch';\nimport { noop } from '../../lib/utils';\nimport Text from '../Typography/Text/Text';\nimport Title from '../Typography/Title/Title';\nimport Separator from '../Separator/Separator';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { useEnsuredControl } from '../../hooks/useEnsuredControl';\n\nexport type InputRef = (element: HTMLInputElement) => void;\n\nexport interface SearchProps extends InputHTMLAttributes<HTMLInputElement>, HasRef<HTMLInputElement>, HasPlatform {\n  /**\n   * iOS only. Текст кнопки \"отмена\", которая чистит текстовое поле и убирает фокус.\n   */\n  after?: ReactNode;\n  before?: ReactNode;\n  icon?: ReactNode;\n  onIconClick?: (e: VKUITouchEvent) => void;\n  defaultValue?: string;\n}\n\nconst Search: FC<SearchProps> = ({\n  before,\n  className,\n  defaultValue,\n  placeholder,\n  after,\n  getRef,\n  platform,\n  icon,\n  onIconClick = noop,\n  style,\n  ...inputProps\n}) => {\n  const inputRef = useExternRef(getRef);\n  const [isFocused, setFocused] = useState(false);\n  const [value, onChange] = useEnsuredControl(inputProps, { defaultValue });\n\n  const onFocus = (e: FocusEvent<HTMLInputElement>) => {\n    setFocused(true);\n    inputProps.onFocus && inputProps.onFocus(e);\n  };\n\n  const onBlur = (e: FocusEvent<HTMLInputElement>) => {\n    setFocused(false);\n    inputProps.onBlur && inputProps.onBlur(e);\n  };\n\n  const onCancel = () => {\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    const nativeInputValueSetter = Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype, 'value').set;\n    nativeInputValueSetter.call(inputRef.current, '');\n\n    const ev2 = new Event('input', { bubbles: true });\n    inputRef.current.dispatchEvent(ev2);\n  };\n\n  const onIconClickStart = useCallback((e: TouchEvent) => onIconClick(e.originalEvent), [onIconClick]);\n\n  const onIconCancelClickStart = useCallback((e: TouchEvent) => {\n    e.originalEvent.preventDefault();\n    inputRef.current.focus();\n    onCancel();\n  }, [onCancel]);\n\n  return (\n    <div\n      vkuiClass={classNames(getClassName('Search', platform), {\n        'Search--focused': isFocused,\n        'Search--has-value': !!value,\n        'Search--has-after': !!after,\n        'Search--has-icon': !!icon,\n      })}\n      className={className}\n      style={style}\n    >\n      <div vkuiClass=\"Search__in\">\n        <div vkuiClass=\"Search__width\" />\n        <label vkuiClass=\"Search__control\">\n          <input\n            type=\"search\"\n            {...inputProps}\n            ref={inputRef}\n            vkuiClass=\"Search__input\"\n            onFocus={onFocus}\n            onBlur={onBlur}\n            onChange={onChange}\n            value={value}\n          />\n          {platform === IOS && after && <div vkuiClass=\"Search__after-width\">{after}</div>}\n          <div vkuiClass=\"Search__placeholder\">\n            <div vkuiClass=\"Search__placeholder-in\">\n              {before}\n              {platform === VKCOM\n                ? <Text vkuiClass=\"Search__placeholder-text\" weight=\"regular\">{placeholder}</Text>\n                : <Title vkuiClass=\"Search__placeholder-text\" level=\"3\" weight=\"regular\">{placeholder}</Title>\n              }\n            </div>\n            {isFocused && platform === IOS && after && <div vkuiClass=\"Search__after-width\">{after}</div>}\n          </div>\n        </label>\n        <div vkuiClass=\"Search__after\" onClick={onCancel}>\n          <div vkuiClass=\"Search__icons\">\n            {icon &&\n              <Touch onStart={onIconClickStart} vkuiClass=\"Search__icon\">\n                {icon}\n              </Touch>\n            }\n            {!!value &&\n              <Touch onStart={onIconCancelClickStart} vkuiClass=\"Search__icon\">\n                {platform === VKCOM\n                  ? <Icon24Cancel />\n                  : <Icon16Clear />\n                }\n              </Touch>\n            }\n          </div>\n          {platform === IOS && after &&\n            <div vkuiClass=\"Search__after-in\">{after}</div>\n          }\n        </div>\n      </div>\n      {platform === VKCOM && <Separator vkuiClass=\"Search__separator\" wide />}\n    </div>\n  );\n};\n\nSearch.defaultProps = {\n  autoComplete: 'off',\n  defaultValue: '',\n  placeholder: 'Поиск',\n  after: 'Отмена',\n  before: <Icon16SearchOutline />,\n};\n\nexport default withPlatform(Search);\n"]},"metadata":{},"sourceType":"module"}