{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _createSuper from \"@babel/runtime/helpers/createSuper\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport { createScopedElement } from \"../../lib/jsxRuntime\";\nimport React, { Component } from 'react';\nimport { getClassName } from \"../../helpers/getClassName\";\nimport { classNames } from \"../../lib/classNames\";\nimport { ANDROID, VKCOM } from \"../../lib/platform\";\nimport { animationEvent } from \"../../lib/supportEvents\";\nimport { withPlatform } from \"../../hoc/withPlatform\";\nimport { canUseDOM, withDOM } from \"../../lib/dom\";\n\nvar PopoutWrapper = /*#__PURE__*/function (_Component) {\n  _inherits(PopoutWrapper, _Component);\n\n  var _super = _createSuper(PopoutWrapper);\n\n  function PopoutWrapper(props) {\n    var _this;\n\n    _classCallCheck(this, PopoutWrapper);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"elRef\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"animationFinishTimeout\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"onFadeInEnd\", function (e) {\n      if (!e || e.animationName === 'vkui-animation-full-fade-in') {\n        _this.setState({\n          opened: true\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"preventTouch\", function (e) {\n      return e.preventDefault();\n    });\n\n    _this.state = {\n      opened: !props.hasMask\n    };\n    _this.elRef = /*#__PURE__*/React.createRef();\n    return _this;\n  }\n\n  _createClass(PopoutWrapper, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      if (canUseDOM) {\n        this.props.window.addEventListener('touchmove', this.preventTouch, {\n          passive: false\n        });\n        this.waitAnimationFinish(this.elRef.current, this.onFadeInEnd);\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      // Здесь нужен последний аргумент с такими же параметрами, потому что\n      // некоторые браузеры на странных вендорах типа Meizu не удаляют обработчик.\n      // https://github.com/VKCOM/VKUI/issues/444\n      if (canUseDOM) {\n        // @ts-ignore (В интерфейсе EventListenerOptions нет поля passive)\n        this.props.window.removeEventListener('touchmove', this.preventTouch, {\n          passive: false\n        });\n        clearTimeout(this.animationFinishTimeout);\n      }\n    }\n  }, {\n    key: \"waitAnimationFinish\",\n    value: function waitAnimationFinish(elem, eventHandler) {\n      if (animationEvent.supported) {\n        elem.removeEventListener(animationEvent.name, eventHandler);\n        elem.addEventListener(animationEvent.name, eventHandler);\n      } else {\n        clearTimeout(this.animationFinishTimeout);\n        this.animationFinishTimeout = setTimeout(eventHandler, this.props.platform === ANDROID || this.props.platform === VKCOM ? 200 : 300);\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n          alignY = _this$props.alignY,\n          alignX = _this$props.alignX,\n          closing = _this$props.closing,\n          children = _this$props.children,\n          hasMask = _this$props.hasMask,\n          fixed = _this$props.fixed,\n          platform = _this$props.platform,\n          onClick = _this$props.onClick,\n          window = _this$props.window,\n          document = _this$props.document,\n          restProps = _objectWithoutProperties(_this$props, [\"alignY\", \"alignX\", \"closing\", \"children\", \"hasMask\", \"fixed\", \"platform\", \"onClick\", \"window\", \"document\"]);\n\n      var baseClassNames = getClassName('PopoutWrapper', platform);\n      return createScopedElement(\"div\", _extends({}, restProps, {\n        vkuiClass: classNames(baseClassNames, \"PopoutWrapper--v-\".concat(alignY), \"PopoutWrapper--h-\".concat(alignX), {\n          'PopoutWrapper--closing': closing,\n          'PopoutWrapper--opened': this.state.opened,\n          'PopoutWrapper--fixed': fixed,\n          'PopoutWrapper--masked': hasMask\n        }),\n        ref: this.elRef\n      }), createScopedElement(\"div\", {\n        vkuiClass: \"PopoutWrapper__container\"\n      }, createScopedElement(\"div\", {\n        vkuiClass: \"PopoutWrapper__overlay\",\n        onClick: onClick\n      }), createScopedElement(\"div\", {\n        vkuiClass: \"PopoutWrapper__content\"\n      }, children)));\n    }\n  }]);\n\n  return PopoutWrapper;\n}(Component);\n\n_defineProperty(PopoutWrapper, \"defaultProps\", {\n  hasMask: true,\n  fixed: true,\n  alignY: 'center',\n  alignX: 'center',\n  closing: false\n});\n\nexport default withPlatform(withDOM(PopoutWrapper));","map":{"version":3,"sources":["../../../src/components/PopoutWrapper/PopoutWrapper.tsx"],"names":["PopoutWrapper","Component","opened","props","hasMask","React","fixed","alignY","alignX","closing","passive","clearTimeout","elem","eventHandler","animationEvent","setTimeout","e","children","platform","onClick","window","document","restProps","baseClassNames","getClassName","classNames","elRef","withPlatform","withDOM"],"mappings":"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","sourcesContent":["import React, { Component, HTMLAttributes, MouseEvent } from 'react';\nimport { getClassName } from '../../helpers/getClassName';\nimport { classNames } from '../../lib/classNames';\nimport { ANDROID, VKCOM } from '../../lib/platform';\nimport { animationEvent } from '../../lib/supportEvents';\nimport { withPlatform } from '../../hoc/withPlatform';\nimport { HasPlatform } from '../../types';\nimport { canUseDOM, withDOM, DOMProps } from '../../lib/dom';\n\nexport interface PopoutWrapperProps extends HTMLAttributes<HTMLDivElement>, HasPlatform {\n  hasMask?: boolean;\n  fixed?: boolean;\n  alignY?: 'top' | 'center' | 'bottom';\n  alignX?: 'left' | 'center' | 'right';\n  closing?: boolean;\n}\n\nexport interface PopoutWrapperState {\n  opened: boolean;\n}\n\nexport type WindowTouchListener = (e: Event) => void;\n\nexport type AnimationEndCallback = (e?: AnimationEvent) => void;\n\nexport type ClickHandler = (e: MouseEvent<HTMLDivElement>) => void;\n\nclass PopoutWrapper extends Component<PopoutWrapperProps & DOMProps, PopoutWrapperState> {\n  constructor(props: PopoutWrapperProps) {\n    super(props);\n    this.state = {\n      opened: !props.hasMask,\n    };\n    this.elRef = React.createRef();\n  }\n\n  static defaultProps: PopoutWrapperProps = {\n    hasMask: true,\n    fixed: true,\n    alignY: 'center',\n    alignX: 'center',\n    closing: false,\n  };\n\n  elRef: React.RefObject<HTMLDivElement>;\n\n  private animationFinishTimeout: ReturnType<typeof setTimeout>;\n\n  componentDidMount() {\n    if (canUseDOM) {\n      this.props.window.addEventListener('touchmove', this.preventTouch, { passive: false });\n      this.waitAnimationFinish(this.elRef.current, this.onFadeInEnd);\n    }\n  }\n\n  componentWillUnmount() {\n    // Здесь нужен последний аргумент с такими же параметрами, потому что\n    // некоторые браузеры на странных вендорах типа Meizu не удаляют обработчик.\n    // https://github.com/VKCOM/VKUI/issues/444\n    if (canUseDOM) {\n      // @ts-ignore (В интерфейсе EventListenerOptions нет поля passive)\n      this.props.window.removeEventListener('touchmove', this.preventTouch, { passive: false });\n      clearTimeout(this.animationFinishTimeout);\n    }\n  }\n\n  waitAnimationFinish(elem: HTMLDivElement, eventHandler: AnimationEndCallback) {\n    if (animationEvent.supported) {\n      elem.removeEventListener(animationEvent.name, eventHandler);\n      elem.addEventListener(animationEvent.name, eventHandler);\n    } else {\n      clearTimeout(this.animationFinishTimeout);\n      this.animationFinishTimeout = setTimeout(eventHandler, this.props.platform === ANDROID || this.props.platform === VKCOM ? 200 : 300);\n    }\n  }\n\n  onFadeInEnd: AnimationEndCallback = (e: AnimationEvent) => {\n    if (!e || e.animationName === 'vkui-animation-full-fade-in') {\n      this.setState({ opened: true });\n    }\n  };\n\n  preventTouch: WindowTouchListener = (e: Event) => e.preventDefault();\n\n  render() {\n    const { alignY, alignX, closing, children, hasMask, fixed, platform, onClick, window, document, ...restProps } = this.props;\n    const baseClassNames = getClassName('PopoutWrapper', platform);\n\n    return (\n      <div\n        {...restProps}\n        vkuiClass={classNames(baseClassNames, `PopoutWrapper--v-${alignY}`, `PopoutWrapper--h-${alignX}`, {\n          'PopoutWrapper--closing': closing,\n          'PopoutWrapper--opened': this.state.opened,\n          'PopoutWrapper--fixed': fixed,\n          'PopoutWrapper--masked': hasMask,\n        })}\n        ref={this.elRef}\n      >\n        <div vkuiClass=\"PopoutWrapper__container\">\n          <div\n            vkuiClass=\"PopoutWrapper__overlay\"\n            onClick={onClick} />\n          <div vkuiClass=\"PopoutWrapper__content\">\n            {children}\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default withPlatform(withDOM<PopoutWrapperProps>(PopoutWrapper));\n"]},"metadata":{},"sourceType":"module"}