{"version":3,"sources":["../../../src/components/ConfigProvider/ConfigProvider.tsx"],"names":["useState","useEffect","canUseDOM","useDOM","ConfigProviderContext","Scheme","defaultConfigProviderProps","ExternalScheme","VKCOM","useIsomorphicLayoutEffect","useObjectMemo","noop","warnOnce","useSchemeDetector","node","_scheme","inherit","getScheme","undefined","getAttribute","resolvedScheme","setScheme","observer","MutationObserver","observe","attributes","attributeFilter","disconnect","deriveAppearance","scheme","SPACE_GRAY","VKCOM_DARK","normalizeScheme","platform","DEPRECATED_CLIENT_LIGHT","BRIGHT_LIGHT","DEPRECATED_CLIENT_DARK","warn","ConfigProvider","children","schemeTarget","config","document","target","body","process","env","NODE_ENV","hasAttribute","setAttribute","removeAttribute","realScheme","configContext","appearance","defaultProps"],"mappings":";;;;AAAA,SAAaA,QAAb,EAAuBC,SAAvB,QAAmD,OAAnD;AAEA,SAASC,SAAT,EAAoBC,MAApB;AACA,SACEC,qBADF,EAGEC,MAHF,EAKEC,0BALF,EAMEC,cANF;AAQA,SAAuBC,KAAvB;AACA,SAASC,yBAAT;AACA,SAASC,aAAT;AACA,SAASC,IAAT;AACA,SAASC,QAAT;;AASA,SAASC,iBAAT,CAA2BC,IAA3B,EAA8CC,OAA9C,EAA2E;AACzE,MAAMC,OAAO,GAAGD,OAAO,KAAK,SAA5B;;AACA,MAAME,SAAS,GAAG,SAAZA,SAAY,GAAM;AACtB,QAAI,CAACD,OAAD,IAAY,CAACd,SAAjB,EAA4B;AAC1B,aAAOgB,SAAP;AACD;;AACD,WAAOJ,IAAI,CAACK,YAAL,CAAkB,QAAlB,CAAP;AACD,GALD;;AAFyE,kBAQrCnB,QAAQ,CAACiB,SAAS,EAAV,CAR6B;AAAA;AAAA,MAQlEG,cARkE;AAAA,MAQlDC,SARkD;;AAUzEpB,EAAAA,SAAS,CAAC,YAAM;AACd,QAAI,CAACe,OAAL,EAAc;AACZ,aAAOL,IAAP;AACD;;AACDU,IAAAA,SAAS,CAACJ,SAAS,EAAV,CAAT;AACA,QAAMK,QAAQ,GAAG,IAAIC,gBAAJ,CAAqB;AAAA,aAAMF,SAAS,CAACJ,SAAS,EAAV,CAAf;AAAA,KAArB,CAAjB;AACAK,IAAAA,QAAQ,CAACE,OAAT,CAAiBV,IAAjB,EAAuB;AAAEW,MAAAA,UAAU,EAAE,IAAd;AAAoBC,MAAAA,eAAe,EAAE,CAAC,QAAD;AAArC,KAAvB;AACA,WAAO;AAAA,aAAMJ,QAAQ,CAACK,UAAT,EAAN;AAAA,KAAP;AACD,GARQ,EAQN,CAACX,OAAD,CARM,CAAT;AAUA,SAAOD,OAAO,KAAK,SAAZ,GAAwBK,cAAxB,GAAyCL,OAAhD;AACD;;AAED,IAAMa,gBAAgB,GAAG,SAAnBA,gBAAmB,CAACC,MAAD;AAAA,SACvBA,MAAM,KAAKxB,MAAM,CAACyB,UAAlB,IAAgCD,MAAM,KAAKtB,cAAc,CAACwB,UAA1D,GAAuE,MAAvE,GAAgF,OADzD;AAAA,CAAzB;;AAGA,SAASC,eAAT,CAAyBH,MAAzB,EAAmDI,QAAnD,EAA+F;AAC7F,MAAIJ,MAAM,KAAK,SAAf,EAA0B;AACxB,WAAOA,MAAP;AACD;;AACD,MAAII,QAAQ,KAAKzB,KAAjB,EAAwB;AACtB,WAAOH,MAAM,CAACG,KAAd;AACD;;AACD,UAAQqB,MAAR;AACE,SAAKxB,MAAM,CAAC6B,uBAAZ;AACE,aAAO7B,MAAM,CAAC8B,YAAd;;AACF,SAAK9B,MAAM,CAAC+B,sBAAZ;AACE,aAAO/B,MAAM,CAACyB,UAAd;;AACF;AACE,aAAOD,MAAP;AANJ;AAQD;;AAED,IAAMQ,IAAI,GAAGzB,QAAQ,CAAC,gBAAD,CAArB;;AAEA,IAAM0B,cAAuC,GAAG,SAA1CA,cAA0C,OAIkC;AAAA,MAHhFC,QAGgF,QAHhFA,QAGgF;AAAA,MAFhFC,YAEgF,QAFhFA,YAEgF;AAAA,MAD7EC,MAC6E;;AAChF,MAAMZ,MAAM,GAAGG,eAAe,CAACS,MAAM,CAACZ,MAAR,EAAgBY,MAAM,CAACR,QAAvB,CAA9B;;AADgF,gBAE3D9B,MAAM,EAFqD;AAAA,MAExEuC,QAFwE,WAExEA,QAFwE;;AAGhF,MAAMC,MAAM,GAAGH,YAAY,KAAIE,QAAJ,aAAIA,QAAJ,uBAAIA,QAAQ,CAAEE,IAAd,CAA3B;AAEAnC,EAAAA,yBAAyB,CAAC,YAAM;AAC9B,QAAIoB,MAAM,KAAK,SAAf,EAA0B;AACxB,aAAOlB,IAAP;AACD;;AACD,QAAIkC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,aAAzB,IAA0CJ,MAAM,CAACK,YAAP,CAAoB,QAApB,CAA9C,EAA6E;AAC3EX,MAAAA,IAAI,CAAC,4EAAD,CAAJ;AACD;;AACDM,IAAAA,MAAM,CAACM,YAAP,CAAoB,QAApB,EAA8BpB,MAA9B;AACA,WAAO;AAAA,aAAMc,MAAM,CAACO,eAAP,CAAuB,QAAvB,CAAN;AAAA,KAAP;AACD,GATwB,EAStB,CAACrB,MAAD,CATsB,CAAzB;AAWA,MAAMsB,UAAU,GAAGtC,iBAAiB,CAAC8B,MAAD,EAASd,MAAT,CAApC;AACA,MAAMuB,aAAa,GAAG1C,aAAa;AAAG2C,IAAAA,UAAU,EAAEzB,gBAAgB,CAACuB,UAAD;AAA/B,KAAgDV,MAAhD,EAAnC;AAEA,SACE,oBAAC,qBAAD,CAAuB,QAAvB;AAAgC,IAAA,KAAK,EAAEW;AAAvC,KACGb,QADH,CADF;AAKD,CA5BD,C,CA8BA;AACA;;;AACAD,cAAc,CAACgB,YAAf,qBAAmChD,0BAAnC;AAEA,eAAegC,cAAf","sourcesContent":["import { FC, useState, useEffect, ReactNode } from 'react';\nimport { AppearanceType } from '@vkontakte/vk-bridge';\nimport { canUseDOM, useDOM } from '../../lib/dom';\nimport {\n  ConfigProviderContext,\n  ConfigProviderContextInterface,\n  Scheme,\n  AppearanceScheme,\n  defaultConfigProviderProps,\n  ExternalScheme,\n} from './ConfigProviderContext';\nimport { PlatformType, VKCOM } from '../../lib/platform';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { useObjectMemo } from '../../hooks/useObjectMemo';\nimport { noop } from '../../lib/utils';\nimport { warnOnce } from '../../lib/warnOnce';\n\nexport interface ConfigProviderProps extends ConfigProviderContextInterface {\n  /**\n   * Цветовая схема приложения\n   */\n  scheme?: AppearanceScheme;\n}\n\nfunction useSchemeDetector(node: HTMLElement, _scheme: Scheme | 'inherit') {\n  const inherit = _scheme === 'inherit';\n  const getScheme = () => {\n    if (!inherit || !canUseDOM) {\n      return undefined;\n    }\n    return node.getAttribute('scheme') as Scheme | ExternalScheme;\n  };\n  const [resolvedScheme, setScheme] = useState(getScheme());\n\n  useEffect(() => {\n    if (!inherit) {\n      return noop;\n    }\n    setScheme(getScheme());\n    const observer = new MutationObserver(() => setScheme(getScheme()));\n    observer.observe(node, { attributes: true, attributeFilter: ['scheme'] });\n    return () => observer.disconnect();\n  }, [inherit]);\n\n  return _scheme === 'inherit' ? resolvedScheme : _scheme;\n}\n\nconst deriveAppearance = (scheme: Scheme | ExternalScheme): AppearanceType =>\n  scheme === Scheme.SPACE_GRAY || scheme === ExternalScheme.VKCOM_DARK ? 'dark' : 'light';\n\nfunction normalizeScheme(scheme: AppearanceScheme, platform: PlatformType): Scheme | 'inherit' {\n  if (scheme === 'inherit') {\n    return scheme;\n  }\n  if (platform === VKCOM) {\n    return Scheme.VKCOM;\n  }\n  switch (scheme) {\n    case Scheme.DEPRECATED_CLIENT_LIGHT:\n      return Scheme.BRIGHT_LIGHT;\n    case Scheme.DEPRECATED_CLIENT_DARK:\n      return Scheme.SPACE_GRAY;\n    default:\n      return scheme as Scheme;\n  }\n}\n\nconst warn = warnOnce('ConfigProvider');\n\nconst ConfigProvider: FC<ConfigProviderProps> = ({\n  children,\n  schemeTarget,\n  ...config\n}: ConfigProviderProps & { children?: ReactNode; schemeTarget?: HTMLElement }) => {\n  const scheme = normalizeScheme(config.scheme, config.platform);\n  const { document } = useDOM();\n  const target = schemeTarget || document?.body;\n\n  useIsomorphicLayoutEffect(() => {\n    if (scheme === 'inherit') {\n      return noop;\n    }\n    if (process.env.NODE_ENV === 'development' && target.hasAttribute('scheme')) {\n      warn('<body scheme> was set before VKUI mount - did you forget scheme=\"inherit\"?');\n    }\n    target.setAttribute('scheme', scheme);\n    return () => target.removeAttribute('scheme');\n  }, [scheme]);\n\n  const realScheme = useSchemeDetector(target, scheme);\n  const configContext = useObjectMemo({ appearance: deriveAppearance(realScheme), ...config });\n\n  return (\n    <ConfigProviderContext.Provider value={configContext}>\n      {children}\n    </ConfigProviderContext.Provider>\n  );\n};\n\n// Деструктуризация нужна из бага в react-docgen-typescript\n// https://github.com/styleguidist/react-docgen-typescript/issues/195\nConfigProvider.defaultProps = { ...defaultConfigProviderProps };\n\nexport default ConfigProvider;\n"],"file":"ConfigProvider.js"}