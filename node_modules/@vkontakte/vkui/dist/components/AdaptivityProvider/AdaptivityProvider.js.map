{"version":3,"sources":["../../../src/components/AdaptivityProvider/AdaptivityProvider.tsx"],"names":["useEffect","useRef","useState","hasMouse","_hasMouse","AdaptivityContext","SizeType","ViewHeight","ViewWidth","canUseDOM","useDOM","DESKTOP_SIZE","TABLET_SIZE","SMALL_TABLET_SIZE","MOBILE_SIZE","MOBILE_LANDSCAPE_HEIGHT","MEDIUM_HEIGHT","AdaptivityProvider","props","adaptivityRef","updateAdaptivity","window","current","calculateAdaptivity","innerWidth","innerHeight","onResize","calculated","viewWidth","viewHeight","sizeX","sizeY","addEventListener","removeEventListener","children","defaultProps","windowWidth","windowHeight","SMALL_MOBILE","SMALL","REGULAR","DESKTOP","TABLET","SMALL_TABLET","MOBILE","MEDIUM","EXTRA_SMALL","COMPACT"],"mappings":"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","sourcesContent":["import { ReactNode, useEffect, useRef, useState } from 'react';\nimport { hasMouse as _hasMouse } from '@vkontakte/vkjs';\nimport { AdaptivityContext, AdaptivityContextInterface, SizeType, ViewHeight, ViewWidth } from './AdaptivityContext';\nimport { canUseDOM, useDOM } from '../../lib/dom';\n\nexport interface AdaptivityProviderProps extends AdaptivityContextInterface {\n  children?: ReactNode;\n}\n\nexport const DESKTOP_SIZE = 1280;\nexport const TABLET_SIZE = 1024;\nexport const SMALL_TABLET_SIZE = 768;\nexport const MOBILE_SIZE = 320;\n\nexport const MOBILE_LANDSCAPE_HEIGHT = 414;\nexport const MEDIUM_HEIGHT = 720;\n\nexport default function AdaptivityProvider(props: AdaptivityProviderProps) {\n  const adaptivityRef = useRef<AdaptivityContextInterface>(null);\n  const [, updateAdaptivity] = useState({});\n\n  const { window } = useDOM();\n\n  if (!adaptivityRef.current) {\n    adaptivityRef.current = calculateAdaptivity(\n      window ? window.innerWidth : 0,\n      window ? window.innerHeight : 0,\n      props,\n    );\n  }\n\n  useEffect(() => {\n    function onResize() {\n      const calculated = calculateAdaptivity(window.innerWidth, window.innerHeight, props);\n      const { viewWidth, viewHeight, sizeX, sizeY, hasMouse } = adaptivityRef.current;\n\n      if (\n        viewWidth !== calculated.viewWidth ||\n        viewHeight !== calculated.viewHeight ||\n        sizeX !== calculated.sizeX ||\n        sizeY !== calculated.sizeY ||\n        hasMouse !== calculated.hasMouse\n      ) {\n        adaptivityRef.current = calculated;\n        updateAdaptivity({});\n      }\n    }\n\n    onResize();\n    window.addEventListener('resize', onResize, false);\n\n    return () => {\n      window.removeEventListener('resize', onResize, false);\n    };\n  }, [props.viewWidth, props.viewHeight, props.sizeX, props.sizeY, props.hasMouse]);\n\n  return (\n    <AdaptivityContext.Provider value={adaptivityRef.current}>\n      {props.children}\n    </AdaptivityContext.Provider>\n  );\n}\n\nAdaptivityProvider.defaultProps = {\n  window: canUseDOM && window,\n};\n\nfunction calculateAdaptivity(windowWidth: number, windowHeight: number, props: AdaptivityProviderProps) {\n  let viewWidth = ViewWidth.SMALL_MOBILE;\n  let viewHeight = ViewHeight.SMALL;\n  let sizeY = SizeType.REGULAR;\n  let sizeX = SizeType.REGULAR;\n  let hasMouse = typeof props.hasMouse === 'boolean' ? props.hasMouse : _hasMouse;\n\n  if (windowWidth >= DESKTOP_SIZE) {\n    viewWidth = ViewWidth.DESKTOP;\n  } else if (windowWidth >= TABLET_SIZE) {\n    viewWidth = ViewWidth.TABLET;\n  } else if (windowWidth >= SMALL_TABLET_SIZE) {\n    viewWidth = ViewWidth.SMALL_TABLET;\n  } else if (windowWidth >= MOBILE_SIZE) {\n    viewWidth = ViewWidth.MOBILE;\n  } else {\n    viewWidth = ViewWidth.SMALL_MOBILE;\n  }\n\n  if (windowHeight >= MEDIUM_HEIGHT) {\n    viewHeight = ViewHeight.MEDIUM;\n  } else if (windowHeight > MOBILE_LANDSCAPE_HEIGHT) {\n    viewHeight = ViewHeight.SMALL;\n  } else {\n    viewHeight = ViewHeight.EXTRA_SMALL;\n  }\n\n  props.viewWidth && (viewWidth = props.viewWidth);\n  props.viewHeight && (viewHeight = props.viewHeight);\n\n  if (viewWidth <= ViewWidth.MOBILE) {\n    sizeX = SizeType.COMPACT;\n  }\n\n  if (viewWidth >= ViewWidth.SMALL_TABLET && hasMouse || viewHeight <= ViewHeight.EXTRA_SMALL) {\n    sizeY = SizeType.COMPACT;\n  }\n\n  props.sizeX && (sizeX = props.sizeX);\n  props.sizeY && (sizeY = props.sizeY);\n\n  return { viewWidth, viewHeight, sizeX, sizeY, hasMouse };\n}\n"],"file":"AdaptivityProvider.js"}