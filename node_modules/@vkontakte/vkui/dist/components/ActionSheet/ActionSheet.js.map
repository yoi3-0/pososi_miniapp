{"version":3,"sources":["../../../src/components/ActionSheet/ActionSheet.tsx"],"names":["React","Component","PopoutWrapper","transitionEvent","withPlatform","withAdaptivity","ViewWidth","ViewHeight","ANDROID","IOS","VKCOM","ActionSheetDropdownDesktop","ActionSheetDropdown","hasReactNode","ActionSheetContext","Caption","ActionSheet","props","closing","setState","waitTransitionFinish","onClose","action","autoclose","event","persist","elRef","createRef","eventHandler","isDesktop","supported","current","removeEventListener","name","addEventListener","clearTimeout","transitionFinishTimeout","setTimeout","platform","children","className","header","text","style","viewWidth","viewHeight","hasMouse","iosCloseItem","restProps","DropdownComponent","state","onItemClick","SMALL_TABLET","MEDIUM","popupDirection"],"mappings":"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","sourcesContent":["import React, { Component, HTMLAttributes } from 'react';\nimport PopoutWrapper from '../PopoutWrapper/PopoutWrapper';\nimport { transitionEvent } from '../../lib/supportEvents';\nimport { withPlatform } from '../../hoc/withPlatform';\nimport { withAdaptivity, AdaptivityProps, ViewWidth, ViewHeight } from '../../hoc/withAdaptivity';\nimport { HasPlatform } from '../../types';\nimport { ANDROID, IOS, VKCOM } from '../../lib/platform';\nimport ActionSheetDropdownDesktop from './ActionSheetDropdownDesktop';\nimport ActionSheetDropdown from './ActionSheetDropdown';\nimport { hasReactNode } from '../../lib/utils';\nimport { ActionSheetContext, ItemClickHandler } from './ActionSheetContext';\nimport Caption from '../Typography/Caption/Caption';\n\nexport type PopupDirectionFunction = (elRef: React.RefObject<HTMLDivElement>) => 'top' | 'bottom';\n\nexport interface ActionSheetProps extends HTMLAttributes<HTMLDivElement>, HasPlatform, AdaptivityProps {\n  header?: React.ReactNode;\n  text?: React.ReactNode;\n  onClose?: VoidFunction;\n  /**\n   * Desktop only\n   */\n  toggleRef: Element;\n  /**\n   * Desktop only\n   */\n  popupDirection?: 'top' | 'bottom' | PopupDirectionFunction;\n  /**\n   * iOS only\n   */\n  iosCloseItem: React.ReactNode;\n}\n\nexport interface ActionSheetState {\n  closing: boolean;\n}\n\nexport type CloseCallback = () => void;\n\nexport type AnimationEndCallback = (e?: AnimationEvent) => void;\n\nclass ActionSheet extends Component<ActionSheetProps, ActionSheetState> {\n  constructor(props: ActionSheetProps) {\n    super(props);\n    this.elRef = React.createRef();\n  }\n\n  state: ActionSheetState = {\n    closing: false,\n  };\n\n  elRef: React.RefObject<HTMLDivElement>;\n\n  private transitionFinishTimeout: ReturnType<typeof setTimeout>;\n\n  static defaultProps: Partial<ActionSheetProps> = {\n    popupDirection: 'bottom',\n  };\n\n  onClose: CloseCallback = () => {\n    this.setState({ closing: true });\n    this.waitTransitionFinish(this.props.onClose);\n  };\n\n  onItemClick: ItemClickHandler = (action, autoclose) => (event) => {\n    event.persist();\n\n    if (autoclose) {\n      this.setState({ closing: true });\n      this.waitTransitionFinish(() => {\n        this.props.onClose();\n        action && action(event);\n      });\n    } else {\n      action && action(event);\n    }\n  };\n\n  get isDesktop() {\n    const { viewWidth, viewHeight, hasMouse } = this.props;\n    return viewWidth >= ViewWidth.SMALL_TABLET && (hasMouse || viewHeight >= ViewHeight.MEDIUM);\n  }\n\n  waitTransitionFinish(eventHandler: AnimationEndCallback) {\n    if (this.isDesktop) {\n      return eventHandler();\n    }\n\n    if (transitionEvent.supported) {\n      this.elRef.current.removeEventListener(transitionEvent.name, eventHandler);\n      this.elRef.current.addEventListener(transitionEvent.name, eventHandler);\n    } else {\n      clearTimeout(this.transitionFinishTimeout);\n      this.transitionFinishTimeout = setTimeout(eventHandler, this.props.platform === ANDROID || this.props.platform === VKCOM ? 200 : 300);\n    }\n  }\n\n  render() {\n    const {\n      children,\n      className,\n      header,\n      text,\n      style,\n      platform,\n      viewWidth,\n      viewHeight,\n      hasMouse,\n      iosCloseItem,\n      ...restProps\n    } = this.props;\n\n    const isDesktop = this.isDesktop;\n\n    const DropdownComponent = isDesktop\n      ? ActionSheetDropdownDesktop\n      : ActionSheetDropdown;\n\n    return (\n      <PopoutWrapper\n        closing={this.state.closing}\n        alignY=\"bottom\"\n        className={className}\n        style={style}\n        onClick={!isDesktop ? this.onClose : null}\n        hasMask={!isDesktop}\n        fixed={!isDesktop}\n      >\n        <ActionSheetContext.Provider\n          value={{\n            onItemClick: this.onItemClick,\n            isDesktop,\n          }}\n        >\n          <DropdownComponent\n            closing={this.state.closing}\n            onClose={this.onClose}\n            elementRef={this.elRef}\n            {...restProps}\n          >\n            {(hasReactNode(header) || hasReactNode(text)) &&\n              <header vkuiClass=\"ActionSheet__header\">\n                {hasReactNode(header) &&\n                  <Caption level=\"1\" weight={platform === IOS ? 'semibold' : 'medium'} vkuiClass=\"ActionSheet__title\">\n                    {header}\n                  </Caption>\n                }\n                {hasReactNode(text) && <Caption level=\"1\" weight=\"regular\" vkuiClass=\"ActionSheet__text\">{text}</Caption>}\n              </header>\n            }\n            {children}\n            {platform === IOS && !isDesktop && iosCloseItem}\n          </DropdownComponent>\n        </ActionSheetContext.Provider>\n      </PopoutWrapper>\n    );\n  }\n}\n\nexport default withAdaptivity(withPlatform(ActionSheet), {\n  viewWidth: true,\n  viewHeight: true,\n  hasMouse: true,\n});\n"],"file":"ActionSheet.js"}