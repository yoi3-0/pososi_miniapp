{"version":3,"sources":["../../../src/components/Alert/Alert.tsx"],"names":["React","Component","Tappable","PopoutWrapper","getClassName","classNames","transitionEvent","ANDROID","VKCOM","IOS","withPlatform","withAdaptivity","ViewWidth","Button","hasReactNode","Headline","Title","Caption","ModalDismissButton","Alert","props","item","action","autoclose","setState","closing","waitTransitionFinish","e","propertyName","onClose","stopPropagation","i","platform","href","mode","onItemClick","title","element","createRef","state","eventHandler","supported","current","removeEventListener","name","addEventListener","clearTimeout","transitionFinishTimeout","setTimeout","bind","header","text","actions","actionsLayout","children","className","style","viewWidth","restProps","resolvedActionsLayout","canShowCloseButton","SMALL_TABLET","isDesktop","renderHeader","renderText","map","renderAction"],"mappings":"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","sourcesContent":["import React, { Component, HTMLAttributes, MouseEventHandler, ReactNode, SyntheticEvent } from 'react';\nimport Tappable from '../Tappable/Tappable';\nimport PopoutWrapper from '../PopoutWrapper/PopoutWrapper';\nimport { getClassName } from '../../helpers/getClassName';\nimport { classNames } from '../../lib/classNames';\nimport { transitionEvent } from '../../lib/supportEvents';\nimport { ANDROID, VKCOM, IOS } from '../../lib/platform';\nimport { HasPlatform } from '../../types';\nimport { withPlatform } from '../../hoc/withPlatform';\nimport { withAdaptivity, AdaptivityProps, ViewWidth } from '../../hoc/withAdaptivity';\nimport Button, { ButtonProps } from '../Button/Button';\nimport { hasReactNode } from '../../lib/utils';\nimport Headline from '../Typography/Headline/Headline';\nimport Title from '../Typography/Title/Title';\nimport Caption from '../Typography/Caption/Caption';\nimport ModalDismissButton from '../ModalDismissButton/ModalDismissButton';\n\nexport type AlertActionInterface = AlertProps['actions'][0];\n\nexport interface AlertAction extends Pick<ButtonProps, 'Component' | 'href'> {\n  title: string;\n  action?: VoidFunction;\n  autoclose?: boolean;\n  mode: 'cancel' | 'destructive' | 'default';\n}\n\nexport interface AlertProps extends HTMLAttributes<HTMLElement>, HasPlatform, AdaptivityProps {\n  actionsLayout?: 'vertical' | 'horizontal';\n  actions?: AlertAction[];\n  header?: ReactNode;\n  text?: ReactNode;\n  onClose?: VoidFunction;\n}\n\nexport interface AlertState {\n  closing: boolean;\n}\n\ntype TransitionEndHandler = (e?: TransitionEvent) => void;\n\ntype ItemClickHander = (item: AlertActionInterface) => () => void;\n\nclass Alert extends Component<AlertProps, AlertState> {\n  constructor(props: AlertProps) {\n    super(props);\n    this.element = React.createRef();\n    this.state = {\n      closing: false,\n    };\n  }\n\n  element: React.RefObject<HTMLDivElement>;\n\n  private transitionFinishTimeout: ReturnType<typeof setTimeout>;\n\n  static defaultProps: AlertProps = {\n    actionsLayout: 'horizontal',\n    actions: [],\n  };\n\n  onItemClick: ItemClickHander = (item: AlertActionInterface) => () => {\n    const { action, autoclose } = item;\n\n    if (autoclose) {\n      this.setState({ closing: true });\n      this.waitTransitionFinish((e?: TransitionEvent) => {\n        if (!e || e.propertyName === 'opacity') {\n          autoclose && this.props.onClose();\n          action && action();\n        }\n      });\n    } else {\n      action && action();\n    }\n  };\n\n  onClose: VoidFunction = () => {\n    this.setState({ closing: true });\n    this.waitTransitionFinish((e?: TransitionEvent) => {\n      if (!e || e.propertyName === 'opacity') {\n        this.props.onClose();\n      }\n    });\n  };\n\n  stopPropagation: MouseEventHandler = (e: SyntheticEvent) => {\n    e.stopPropagation();\n  };\n\n  waitTransitionFinish(eventHandler: TransitionEndHandler) {\n    if (transitionEvent.supported) {\n      this.element.current.removeEventListener(transitionEvent.name, eventHandler);\n      this.element.current.addEventListener(transitionEvent.name, eventHandler);\n    } else {\n      clearTimeout(this.transitionFinishTimeout);\n      this.transitionFinishTimeout = setTimeout(eventHandler.bind(this), this.props.platform === ANDROID || this.props.platform === VKCOM ? 200 : 300);\n    }\n  }\n\n  renderHeader(header: ReactNode) {\n    switch (this.props.platform) {\n      case VKCOM:\n        return <Headline vkuiClass=\"Alert__header\" weight=\"medium\">{header}</Headline>;\n      case IOS:\n        return <Title vkuiClass=\"Alert__header\" weight=\"semibold\" level=\"3\">{header}</Title>;\n      case ANDROID:\n        return <Title vkuiClass=\"Alert__header\" weight=\"medium\" level=\"2\">{header}</Title>;\n    }\n  }\n\n  renderText(text: ReactNode) {\n    switch (this.props.platform) {\n      case VKCOM:\n        return <Caption vkuiClass=\"Alert__text\" level=\"1\" weight=\"regular\">{text}</Caption>;\n      case IOS:\n        return <Caption vkuiClass=\"Alert__text\" level=\"2\" weight=\"regular\">{text}</Caption>;\n      case ANDROID:\n        return <Headline vkuiClass=\"Alert__text\" weight=\"regular\">{text}</Headline>;\n    }\n  }\n\n  renderAction = (action: AlertActionInterface, i: number) => {\n    const { platform } = this.props;\n    if (platform === IOS) {\n      const { Component = 'button' } = action;\n      return (\n        <Tappable\n          Component={action.href ? 'a' : Component}\n          vkuiClass={classNames('Alert__action', `Alert__action--${action.mode}`)}\n          onClick={this.onItemClick(action)}\n          href={action.href}\n          key={`alert-action-${i}`}\n        >\n          {action.title}\n        </Tappable>\n      );\n    }\n    const mode: ButtonProps['mode'] = platform === ANDROID\n      ? 'tertiary'\n      : action.mode === 'cancel' ? 'secondary' : 'primary';\n    return (\n      <Button\n        vkuiClass={classNames('Alert__button', `Alert__button--${action.mode}`)}\n        mode={mode}\n        size=\"m\"\n        onClick={this.onItemClick(action)}\n        Component={action.Component}\n        href={action.href}\n        key={`alert-action-${i}`}\n      >\n        {action.title}\n      </Button>\n    );\n  };\n\n  render() {\n    const { actions, actionsLayout, children, className, style, platform, viewWidth, text, header, ...restProps } = this.props;\n    const { closing } = this.state;\n\n    const resolvedActionsLayout: AlertProps['actionsLayout'] = platform === VKCOM ? 'horizontal' : actionsLayout;\n    const canShowCloseButton = platform === VKCOM || platform === ANDROID && viewWidth >= ViewWidth.SMALL_TABLET;\n    const isDesktop = viewWidth >= ViewWidth.SMALL_TABLET;\n\n    return (\n      <PopoutWrapper\n        className={className}\n        closing={closing}\n        style={style}\n        onClick={this.onClose}\n      >\n        <div\n          {...restProps}\n          ref={this.element}\n          onClick={this.stopPropagation}\n          vkuiClass={classNames(getClassName('Alert', platform), {\n            'Alert--v': resolvedActionsLayout === 'vertical',\n            'Alert--h': resolvedActionsLayout === 'horizontal',\n            'Alert--closing': closing,\n            'Alert--desktop': isDesktop,\n          })}\n        >\n          {canShowCloseButton && <ModalDismissButton onClick={this.onClose} />}\n          <div vkuiClass=\"Alert__content\">\n            {hasReactNode(header) && this.renderHeader(header)}\n            {hasReactNode(text) && this.renderText(text)}\n            {children}\n          </div>\n          <footer vkuiClass=\"Alert__actions\">\n            {actions.map(this.renderAction)}\n          </footer>\n        </div>\n      </PopoutWrapper>\n    );\n  }\n}\n\nexport default withPlatform(withAdaptivity(Alert, {\n  viewWidth: true,\n}));\n"],"file":"Alert.js"}