{"version":3,"sources":["../../../../src/components/CustomScrollView/CustomScrollView.tsx"],"names":["CustomScrollView","NaN","e","props","boxRef","clientHeight","box","current","scrollHeight","ratio","trackerHeight","Math","max","barY","style","display","trackerY","height","setTrackerPositionFromScroll","scrollTop","preventDefault","startY","clientY","trackerTop","lastTrackerTop","document","addEventListener","onMove","onUp","diff","position","min","setScrollPositionFromTracker","removeEventListener","chooseTransformProp","resize","windowResize","window","prop","transformProp","progress","setTrackerPosition","onDragStart","scroll","children","React","Component"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;IAOMA,gB;;;;;;;;;;;;;;;wFACYC,G;iGACS,C;+FACF,C;gGACC,C;+FACD,C;gGACC,E;yFAEP,C;6FACI,C;sFAEE,qBAAyB,UAACC,CAAD;AAAA,aAAO,mBAAOA,CAAP,EAAU,MAAKC,KAAL,CAAWC,MAArB,CAAP;AAAA,KAAzB,C;oGACC,uB;wGACI,uB;yFAiCnB,YAAM;AACb,UAAMC,YAAY,GAAG,MAAKC,GAAL,CAASC,OAAT,CAAiBF,YAAtC;AACA,UAAMG,YAAY,GAAG,MAAKF,GAAL,CAASC,OAAT,CAAiBC,YAAtC;AACA,UAAIC,KAAK,GAAGJ,YAAY,GAAGG,YAA3B;AACA,UAAIE,aAAa,GAAGC,IAAI,CAACC,GAAL,CAASP,YAAY,GAAGI,KAAxB,EAA+B,EAA/B,CAApB;AAEA,YAAKA,KAAL,GAAaA,KAAb;AACA,YAAKJ,YAAL,GAAoBA,YAApB;AACA,YAAKG,YAAL,GAAoBA,YAApB;AACA,YAAKE,aAAL,GAAqBA,aAArB;;AAEA,UAAID,KAAK,IAAI,CAAb,EAAgB;AACd,cAAKI,IAAL,CAAUN,OAAV,CAAkBO,KAAlB,CAAwBC,OAAxB,GAAkC,MAAlC;AACD,OAFD,MAEO;AACL,cAAKF,IAAL,CAAUN,OAAV,CAAkBO,KAAlB,CAAwBC,OAAxB,GAAkC,EAAlC;AACA,cAAKC,QAAL,CAAcT,OAAd,CAAsBO,KAAtB,CAA4BG,MAA5B,aAAwCP,aAAxC;;AAEA,cAAKQ,4BAAL,CAAkC,MAAKZ,GAAL,CAASC,OAAT,CAAiBY,SAAnD;AACD;AACF,K;yFAEQ,YAAM;AACb,UAAI,MAAKV,KAAL,IAAc,CAAlB,EAAqB;AACnB;AACD;;AAED,YAAKS,4BAAL,CAAkC,MAAKZ,GAAL,CAASC,OAAT,CAAiBY,SAAnD;AACD,K;8FAiBa,UAACjB,CAAD,EAAyB;AACrCA,MAAAA,CAAC,CAACkB,cAAF;AACA,YAAKC,MAAL,GAAcnB,CAAC,CAACoB,OAAhB;AACA,YAAKC,UAAL,GAAkB,MAAKC,cAAvB;;AAEA,YAAKrB,KAAL,CAAWsB,QAAX,CAAoBC,gBAApB,CAAqC,WAArC,EAAkD,MAAKC,MAAvD;;AACA,YAAKxB,KAAL,CAAWsB,QAAX,CAAoBC,gBAApB,CAAqC,SAArC,EAAgD,MAAKE,IAArD;AACD,K;yFAEQ,UAAC1B,CAAD,EAAmB;AAC1BA,MAAAA,CAAC,CAACkB,cAAF;AACA,UAAMS,IAAI,GAAG3B,CAAC,CAACoB,OAAF,GAAY,MAAKD,MAA9B;AACA,UAAMS,QAAQ,GAAGnB,IAAI,CAACoB,GAAL,CAASpB,IAAI,CAACC,GAAL,CAAS,MAAKW,UAAL,GAAkBM,IAA3B,EAAiC,CAAjC,CAAT,EAA8C,MAAKxB,YAAL,GAAoB,MAAKK,aAAvE,CAAjB;;AAEA,YAAKsB,4BAAL,CAAkCF,QAAlC;AACD,K;uFAEM,UAAC5B,CAAD,EAAmB;AACxBA,MAAAA,CAAC,CAACkB,cAAF;;AACA,YAAKjB,KAAL,CAAWsB,QAAX,CAAoBQ,mBAApB,CAAwC,WAAxC,EAAqD,MAAKN,MAA1D;;AACA,YAAKxB,KAAL,CAAWsB,QAAX,CAAoBQ,mBAApB,CAAwC,SAAxC,EAAmD,MAAKL,IAAxD;AACD,K;;;;;;wCAhGmB;AAClB,WAAKM,mBAAL;AAEA,WAAKC,MAAL;;AAEA,UAAI,KAAKhC,KAAL,CAAWiC,YAAf,EAA6B;AAC3B,aAAKjC,KAAL,CAAWkC,MAAX,CAAkBX,gBAAlB,CAAmC,QAAnC,EAA6C,KAAKS,MAAlD;AACD;AACF;;;yCAEoB;AACnB,WAAKA,MAAL;AACD;;;2CAEsB;AACrB,WAAKhC,KAAL,CAAWkC,MAAX,CAAkBJ,mBAAlB,CAAsC,QAAtC,EAAgD,KAAKE,MAArD;AACD;;;0CAEqB;AACpB,UAAIrB,KAAK,GAAG,KAAKE,QAAL,CAAcT,OAAd,CAAsBO,KAAlC;AACA,UAAIwB,IAAI,GAAG,EAAX;;AAEA,UAAI,eAAexB,KAAnB,EAA0B;AACxBwB,QAAAA,IAAI,GAAG,WAAP;AACD,OAFD,MAEO,IAAI,qBAAqBxB,KAAzB,EAAgC;AACrCwB,QAAAA,IAAI,GAAG,iBAAP;AACD;;AAED,WAAKC,aAAL,GAAqBD,IAArB;AACD;;;uCA+BkBnB,S,EAAmB;AACpC,WAAKK,cAAL,GAAsBL,SAAtB;AACC,WAAKH,QAAL,CAAcT,OAAd,CAAsBO,KAAvB,CAAqC,KAAKyB,aAA1C,2BAA2EpB,SAA3E;AACD;;;iDAE4BA,S,EAAmB;AAC9C,UAAMqB,QAAQ,GAAGrB,SAAS,IAAI,KAAKX,YAAL,GAAoB,KAAKH,YAA7B,CAA1B;AACA,WAAKoC,kBAAL,CAAwB,CAAC,KAAKpC,YAAL,GAAoB,KAAKK,aAA1B,IAA2C8B,QAAnE;AACD;;;iDAE4BjB,U,EAAoB;AAC/C,UAAMiB,QAAQ,GAAGjB,UAAU,IAAI,KAAKlB,YAAL,GAAoB,KAAKK,aAA7B,CAA3B;AACA,WAAKJ,GAAL,CAASC,OAAT,CAAiBY,SAAjB,GAA6B,CAAC,KAAKX,YAAL,GAAoB,KAAKH,YAA1B,IAA0CmC,QAAvE;AACD;;;6BAyBQ;AACP,aAAO;AAAK,QAAA,SAAS,EAAC;AAAf,SACL;AAAK,QAAA,SAAS,EAAC,wBAAf;AAAwC,QAAA,GAAG,EAAE,KAAK3B;AAAlD,SACE;AAAK,QAAA,SAAS,EAAC,4BAAf;AAA4C,QAAA,GAAG,EAAE,KAAKG,QAAtD;AAAgE,QAAA,WAAW,EAAE,KAAK0B;AAAlF,QADF,CADK,EAKL;AAAK,QAAA,SAAS,EAAC,uBAAf;AAAuC,QAAA,QAAQ,EAAE,CAAC,CAAlD;AAAqD,QAAA,GAAG,EAAE,KAAKpC,GAA/D;AAAoE,QAAA,QAAQ,EAAE,KAAKqC;AAAnF,SACG,KAAKxC,KAAL,CAAWyC,QADd,CALK,CAAP;AASD;;;EA3H4BC,eAAMC,S;;eA8HtB,kBAAQ9C,gBAAR,C","sourcesContent":["import React, { createRef, Ref } from 'react';\nimport { DOMProps, withDOM } from '../../lib/dom';\nimport { multiRef, setRef } from '../../lib/utils';\n\ninterface Props extends DOMProps {\n  windowResize?: boolean;\n  boxRef: Ref<HTMLDivElement>;\n}\n\nclass CustomScrollView extends React.Component<Props> {\n  private ratio = NaN;\n  private lastTrackerTop = 0;\n  private clientHeight = 0;\n  private trackerHeight = 0;\n  private scrollHeight = 0;\n  private transformProp = '';\n\n  private startY = 0;\n  private trackerTop = 0;\n\n  private readonly box = multiRef<HTMLDivElement>((e) => setRef(e, this.props.boxRef));\n  private readonly barY = createRef<HTMLDivElement>();\n  private readonly trackerY = createRef<HTMLDivElement>();\n\n  componentDidMount() {\n    this.chooseTransformProp();\n\n    this.resize();\n\n    if (this.props.windowResize) {\n      this.props.window.addEventListener('resize', this.resize);\n    }\n  }\n\n  componentDidUpdate() {\n    this.resize();\n  }\n\n  componentWillUnmount() {\n    this.props.window.removeEventListener('resize', this.resize);\n  }\n\n  chooseTransformProp() {\n    let style = this.trackerY.current.style;\n    let prop = '';\n\n    if ('transform' in style) {\n      prop = 'transform';\n    } else if ('webkitTransform' in style) {\n      prop = 'webkitTransform';\n    }\n\n    this.transformProp = prop;\n  }\n\n  resize = () => {\n    const clientHeight = this.box.current.clientHeight;\n    const scrollHeight = this.box.current.scrollHeight;\n    let ratio = clientHeight / scrollHeight;\n    let trackerHeight = Math.max(clientHeight * ratio, 40);\n\n    this.ratio = ratio;\n    this.clientHeight = clientHeight;\n    this.scrollHeight = scrollHeight;\n    this.trackerHeight = trackerHeight;\n\n    if (ratio >= 1) {\n      this.barY.current.style.display = 'none';\n    } else {\n      this.barY.current.style.display = '';\n      this.trackerY.current.style.height = `${trackerHeight}px`;\n\n      this.setTrackerPositionFromScroll(this.box.current.scrollTop);\n    }\n  };\n\n  scroll = () => {\n    if (this.ratio >= 1) {\n      return;\n    }\n\n    this.setTrackerPositionFromScroll(this.box.current.scrollTop);\n  };\n\n  setTrackerPosition(scrollTop: number) {\n    this.lastTrackerTop = scrollTop;\n    (this.trackerY.current.style as any)[this.transformProp] = `translate(0, ${scrollTop}px)`;\n  }\n\n  setTrackerPositionFromScroll(scrollTop: number) {\n    const progress = scrollTop / (this.scrollHeight - this.clientHeight);\n    this.setTrackerPosition((this.clientHeight - this.trackerHeight) * progress);\n  }\n\n  setScrollPositionFromTracker(trackerTop: number) {\n    const progress = trackerTop / (this.clientHeight - this.trackerHeight);\n    this.box.current.scrollTop = (this.scrollHeight - this.clientHeight) * progress;\n  }\n\n  onDragStart = (e: React.MouseEvent) => {\n    e.preventDefault();\n    this.startY = e.clientY;\n    this.trackerTop = this.lastTrackerTop;\n\n    this.props.document.addEventListener('mousemove', this.onMove);\n    this.props.document.addEventListener('mouseup', this.onUp);\n  };\n\n  onMove = (e: MouseEvent) => {\n    e.preventDefault();\n    const diff = e.clientY - this.startY;\n    const position = Math.min(Math.max(this.trackerTop + diff, 0), this.clientHeight - this.trackerHeight);\n\n    this.setScrollPositionFromTracker(position);\n  };\n\n  onUp = (e: MouseEvent) => {\n    e.preventDefault();\n    this.props.document.removeEventListener('mousemove', this.onMove);\n    this.props.document.removeEventListener('mouseup', this.onUp);\n  };\n\n  render() {\n    return <div vkuiClass=\"CustomScrollView\">\n      <div vkuiClass=\"CustomScrollView__barY\" ref={this.barY}>\n        <div vkuiClass=\"CustomScrollView__trackerY\" ref={this.trackerY} onMouseDown={this.onDragStart} />\n      </div>\n\n      <div vkuiClass=\"CustomScrollView__box\" tabIndex={-1} ref={this.box} onScroll={this.scroll}>\n        {this.props.children}\n      </div>\n    </div>;\n  }\n}\n\nexport default withDOM(CustomScrollView);\n"],"file":"CustomScrollView.js"}