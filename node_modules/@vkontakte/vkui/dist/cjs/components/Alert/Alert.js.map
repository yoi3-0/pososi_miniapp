{"version":3,"sources":["../../../../src/components/Alert/Alert.tsx"],"names":["Alert","props","item","action","autoclose","setState","closing","waitTransitionFinish","e","propertyName","onClose","stopPropagation","i","platform","IOS","Component","href","mode","onItemClick","title","ANDROID","element","React","createRef","state","eventHandler","transitionEvent","supported","current","removeEventListener","name","addEventListener","clearTimeout","transitionFinishTimeout","setTimeout","bind","VKCOM","header","text","actions","actionsLayout","children","className","style","viewWidth","restProps","resolvedActionsLayout","canShowCloseButton","ViewWidth","SMALL_TABLET","isDesktop","renderHeader","renderText","map","renderAction"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;IA2BMA,K;;;;;AACJ,iBAAYC,KAAZ,EAA+B;AAAA;;AAAA;AAC7B,8BAAMA,KAAN;AAD6B;AAAA;AAAA,8FAiBA,UAACC,IAAD;AAAA,aAAgC,YAAM;AAAA,YAC3DC,MAD2D,GACrCD,IADqC,CAC3DC,MAD2D;AAAA,YACnDC,SADmD,GACrCF,IADqC,CACnDE,SADmD;;AAGnE,YAAIA,SAAJ,EAAe;AACb,gBAAKC,QAAL,CAAc;AAAEC,YAAAA,OAAO,EAAE;AAAX,WAAd;;AACA,gBAAKC,oBAAL,CAA0B,UAACC,CAAD,EAAyB;AACjD,gBAAI,CAACA,CAAD,IAAMA,CAAC,CAACC,YAAF,KAAmB,SAA7B,EAAwC;AACtCL,cAAAA,SAAS,IAAI,MAAKH,KAAL,CAAWS,OAAX,EAAb;AACAP,cAAAA,MAAM,IAAIA,MAAM,EAAhB;AACD;AACF,WALD;AAMD,SARD,MAQO;AACLA,UAAAA,MAAM,IAAIA,MAAM,EAAhB;AACD;AACF,OAd8B;AAAA,KAjBA;AAAA,0FAiCP,YAAM;AAC5B,YAAKE,QAAL,CAAc;AAAEC,QAAAA,OAAO,EAAE;AAAX,OAAd;;AACA,YAAKC,oBAAL,CAA0B,UAACC,CAAD,EAAyB;AACjD,YAAI,CAACA,CAAD,IAAMA,CAAC,CAACC,YAAF,KAAmB,SAA7B,EAAwC;AACtC,gBAAKR,KAAL,CAAWS,OAAX;AACD;AACF,OAJD;AAKD,KAxC8B;AAAA,kGA0CM,UAACF,CAAD,EAAuB;AAC1DA,MAAAA,CAAC,CAACG,eAAF;AACD,KA5C8B;AAAA,+FA8EhB,UAACR,MAAD,EAA+BS,CAA/B,EAA6C;AAAA,UAClDC,QADkD,GACrC,MAAKZ,KADgC,CAClDY,QADkD;;AAE1D,UAAIA,QAAQ,KAAKC,aAAjB,EAAsB;AAAA,gCACaX,MADb,CACZY,SADY;AAAA,YACZA,WADY,kCACA,QADA;;AAEpB,eACE,qCAAC,iBAAD;AACE,UAAA,SAAS,EAAEZ,MAAM,CAACa,IAAP,GAAc,GAAd,GAAoBD,WADjC;AAEE,UAAA,SAAS,EAAE,4BAAW,eAAX,2BAA8CZ,MAAM,CAACc,IAArD,EAFb;AAGE,UAAA,OAAO,EAAE,MAAKC,WAAL,CAAiBf,MAAjB,CAHX;AAIE,UAAA,IAAI,EAAEA,MAAM,CAACa,IAJf;AAKE,UAAA,GAAG,yBAAkBJ,CAAlB;AALL,WAOGT,MAAM,CAACgB,KAPV,CADF;AAWD;;AACD,UAAMF,IAAyB,GAAGJ,QAAQ,KAAKO,iBAAb,GAC9B,UAD8B,GAE9BjB,MAAM,CAACc,IAAP,KAAgB,QAAhB,GAA2B,WAA3B,GAAyC,SAF7C;AAGA,aACE,qCAAC,eAAD;AACE,QAAA,SAAS,EAAE,4BAAW,eAAX,2BAA8Cd,MAAM,CAACc,IAArD,EADb;AAEE,QAAA,IAAI,EAAEA,IAFR;AAGE,QAAA,IAAI,EAAC,GAHP;AAIE,QAAA,OAAO,EAAE,MAAKC,WAAL,CAAiBf,MAAjB,CAJX;AAKE,QAAA,SAAS,EAAEA,MAAM,CAACY,SALpB;AAME,QAAA,IAAI,EAAEZ,MAAM,CAACa,IANf;AAOE,QAAA,GAAG,yBAAkBJ,CAAlB;AAPL,SASGT,MAAM,CAACgB,KATV,CADF;AAaD,KA9G8B;AAE7B,UAAKE,OAAL,gBAAeC,eAAMC,SAAN,EAAf;AACA,UAAKC,KAAL,GAAa;AACXlB,MAAAA,OAAO,EAAE;AADE,KAAb;AAH6B;AAM9B;;;;yCAwCoBmB,Y,EAAoC;AACvD,UAAIC,+BAAgBC,SAApB,EAA+B;AAC7B,aAAKN,OAAL,CAAaO,OAAb,CAAqBC,mBAArB,CAAyCH,+BAAgBI,IAAzD,EAA+DL,YAA/D;AACA,aAAKJ,OAAL,CAAaO,OAAb,CAAqBG,gBAArB,CAAsCL,+BAAgBI,IAAtD,EAA4DL,YAA5D;AACD,OAHD,MAGO;AACLO,QAAAA,YAAY,CAAC,KAAKC,uBAAN,CAAZ;AACA,aAAKA,uBAAL,GAA+BC,UAAU,CAACT,YAAY,CAACU,IAAb,CAAkB,IAAlB,CAAD,EAA0B,KAAKlC,KAAL,CAAWY,QAAX,KAAwBO,iBAAxB,IAAmC,KAAKnB,KAAL,CAAWY,QAAX,KAAwBuB,eAA3D,GAAmE,GAAnE,GAAyE,GAAnG,CAAzC;AACD;AACF;;;iCAEYC,M,EAAmB;AAC9B,cAAQ,KAAKpC,KAAL,CAAWY,QAAnB;AACE,aAAKuB,eAAL;AACE,iBAAO,qCAAC,iBAAD;AAAU,YAAA,SAAS,EAAC,eAApB;AAAoC,YAAA,MAAM,EAAC;AAA3C,aAAqDC,MAArD,CAAP;;AACF,aAAKvB,aAAL;AACE,iBAAO,qCAAC,cAAD;AAAO,YAAA,SAAS,EAAC,eAAjB;AAAiC,YAAA,MAAM,EAAC,UAAxC;AAAmD,YAAA,KAAK,EAAC;AAAzD,aAA8DuB,MAA9D,CAAP;;AACF,aAAKjB,iBAAL;AACE,iBAAO,qCAAC,cAAD;AAAO,YAAA,SAAS,EAAC,eAAjB;AAAiC,YAAA,MAAM,EAAC,QAAxC;AAAiD,YAAA,KAAK,EAAC;AAAvD,aAA4DiB,MAA5D,CAAP;AANJ;AAQD;;;+BAEUC,I,EAAiB;AAC1B,cAAQ,KAAKrC,KAAL,CAAWY,QAAnB;AACE,aAAKuB,eAAL;AACE,iBAAO,qCAAC,gBAAD;AAAS,YAAA,SAAS,EAAC,aAAnB;AAAiC,YAAA,KAAK,EAAC,GAAvC;AAA2C,YAAA,MAAM,EAAC;AAAlD,aAA6DE,IAA7D,CAAP;;AACF,aAAKxB,aAAL;AACE,iBAAO,qCAAC,gBAAD;AAAS,YAAA,SAAS,EAAC,aAAnB;AAAiC,YAAA,KAAK,EAAC,GAAvC;AAA2C,YAAA,MAAM,EAAC;AAAlD,aAA6DwB,IAA7D,CAAP;;AACF,aAAKlB,iBAAL;AACE,iBAAO,qCAAC,iBAAD;AAAU,YAAA,SAAS,EAAC,aAApB;AAAkC,YAAA,MAAM,EAAC;AAAzC,aAAoDkB,IAApD,CAAP;AANJ;AAQD;;;6BAoCQ;AAAA,wBACyG,KAAKrC,KAD9G;AAAA,UACCsC,OADD,eACCA,OADD;AAAA,UACUC,aADV,eACUA,aADV;AAAA,UACyBC,QADzB,eACyBA,QADzB;AAAA,UACmCC,SADnC,eACmCA,SADnC;AAAA,UAC8CC,KAD9C,eAC8CA,KAD9C;AAAA,UACqD9B,QADrD,eACqDA,QADrD;AAAA,UAC+D+B,SAD/D,eAC+DA,SAD/D;AAAA,UAC0EN,IAD1E,eAC0EA,IAD1E;AAAA,UACgFD,MADhF,eACgFA,MADhF;AAAA,UAC2FQ,SAD3F;AAAA,UAECvC,OAFD,GAEa,KAAKkB,KAFlB,CAEClB,OAFD;AAIP,UAAMwC,qBAAkD,GAAGjC,QAAQ,KAAKuB,eAAb,GAAqB,YAArB,GAAoCI,aAA/F;AACA,UAAMO,kBAAkB,GAAGlC,QAAQ,KAAKuB,eAAb,IAAsBvB,QAAQ,KAAKO,iBAAb,IAAwBwB,SAAS,IAAII,0BAAUC,YAAhG;AACA,UAAMC,SAAS,GAAGN,SAAS,IAAII,0BAAUC,YAAzC;AAEA,aACE,qCAAC,sBAAD;AACE,QAAA,SAAS,EAAEP,SADb;AAEE,QAAA,OAAO,EAAEpC,OAFX;AAGE,QAAA,KAAK,EAAEqC,KAHT;AAIE,QAAA,OAAO,EAAE,KAAKjC;AAJhB,SAME,uEACMmC,SADN;AAEE,QAAA,GAAG,EAAE,KAAKxB,OAFZ;AAGE,QAAA,OAAO,EAAE,KAAKV,eAHhB;AAIE,QAAA,SAAS,EAAE,4BAAW,gCAAa,OAAb,EAAsBE,QAAtB,CAAX,EAA4C;AACrD,sBAAYiC,qBAAqB,KAAK,UADe;AAErD,sBAAYA,qBAAqB,KAAK,YAFe;AAGrD,4BAAkBxC,OAHmC;AAIrD,4BAAkB4C;AAJmC,SAA5C;AAJb,UAWGH,kBAAkB,IAAI,qCAAC,2BAAD;AAAoB,QAAA,OAAO,EAAE,KAAKrC;AAAlC,QAXzB,EAYE;AAAK,QAAA,SAAS,EAAC;AAAf,SACG,yBAAa2B,MAAb,KAAwB,KAAKc,YAAL,CAAkBd,MAAlB,CAD3B,EAEG,yBAAaC,IAAb,KAAsB,KAAKc,UAAL,CAAgBd,IAAhB,CAFzB,EAGGG,QAHH,CAZF,EAiBE;AAAQ,QAAA,SAAS,EAAC;AAAlB,SACGF,OAAO,CAACc,GAAR,CAAY,KAAKC,YAAjB,CADH,CAjBF,CANF,CADF;AA8BD;;;EAvJiBvC,gB;;8BAAdf,K,kBAa8B;AAChCwC,EAAAA,aAAa,EAAE,YADiB;AAEhCD,EAAAA,OAAO,EAAE;AAFuB,C;;eA6IrB,gCAAa,oCAAevC,KAAf,EAAsB;AAChD4C,EAAAA,SAAS,EAAE;AADqC,CAAtB,CAAb,C","sourcesContent":["import React, { Component, HTMLAttributes, MouseEventHandler, ReactNode, SyntheticEvent } from 'react';\nimport Tappable from '../Tappable/Tappable';\nimport PopoutWrapper from '../PopoutWrapper/PopoutWrapper';\nimport { getClassName } from '../../helpers/getClassName';\nimport { classNames } from '../../lib/classNames';\nimport { transitionEvent } from '../../lib/supportEvents';\nimport { ANDROID, VKCOM, IOS } from '../../lib/platform';\nimport { HasPlatform } from '../../types';\nimport { withPlatform } from '../../hoc/withPlatform';\nimport { withAdaptivity, AdaptivityProps, ViewWidth } from '../../hoc/withAdaptivity';\nimport Button, { ButtonProps } from '../Button/Button';\nimport { hasReactNode } from '../../lib/utils';\nimport Headline from '../Typography/Headline/Headline';\nimport Title from '../Typography/Title/Title';\nimport Caption from '../Typography/Caption/Caption';\nimport ModalDismissButton from '../ModalDismissButton/ModalDismissButton';\n\nexport type AlertActionInterface = AlertProps['actions'][0];\n\nexport interface AlertAction extends Pick<ButtonProps, 'Component' | 'href'> {\n  title: string;\n  action?: VoidFunction;\n  autoclose?: boolean;\n  mode: 'cancel' | 'destructive' | 'default';\n}\n\nexport interface AlertProps extends HTMLAttributes<HTMLElement>, HasPlatform, AdaptivityProps {\n  actionsLayout?: 'vertical' | 'horizontal';\n  actions?: AlertAction[];\n  header?: ReactNode;\n  text?: ReactNode;\n  onClose?: VoidFunction;\n}\n\nexport interface AlertState {\n  closing: boolean;\n}\n\ntype TransitionEndHandler = (e?: TransitionEvent) => void;\n\ntype ItemClickHander = (item: AlertActionInterface) => () => void;\n\nclass Alert extends Component<AlertProps, AlertState> {\n  constructor(props: AlertProps) {\n    super(props);\n    this.element = React.createRef();\n    this.state = {\n      closing: false,\n    };\n  }\n\n  element: React.RefObject<HTMLDivElement>;\n\n  private transitionFinishTimeout: ReturnType<typeof setTimeout>;\n\n  static defaultProps: AlertProps = {\n    actionsLayout: 'horizontal',\n    actions: [],\n  };\n\n  onItemClick: ItemClickHander = (item: AlertActionInterface) => () => {\n    const { action, autoclose } = item;\n\n    if (autoclose) {\n      this.setState({ closing: true });\n      this.waitTransitionFinish((e?: TransitionEvent) => {\n        if (!e || e.propertyName === 'opacity') {\n          autoclose && this.props.onClose();\n          action && action();\n        }\n      });\n    } else {\n      action && action();\n    }\n  };\n\n  onClose: VoidFunction = () => {\n    this.setState({ closing: true });\n    this.waitTransitionFinish((e?: TransitionEvent) => {\n      if (!e || e.propertyName === 'opacity') {\n        this.props.onClose();\n      }\n    });\n  };\n\n  stopPropagation: MouseEventHandler = (e: SyntheticEvent) => {\n    e.stopPropagation();\n  };\n\n  waitTransitionFinish(eventHandler: TransitionEndHandler) {\n    if (transitionEvent.supported) {\n      this.element.current.removeEventListener(transitionEvent.name, eventHandler);\n      this.element.current.addEventListener(transitionEvent.name, eventHandler);\n    } else {\n      clearTimeout(this.transitionFinishTimeout);\n      this.transitionFinishTimeout = setTimeout(eventHandler.bind(this), this.props.platform === ANDROID || this.props.platform === VKCOM ? 200 : 300);\n    }\n  }\n\n  renderHeader(header: ReactNode) {\n    switch (this.props.platform) {\n      case VKCOM:\n        return <Headline vkuiClass=\"Alert__header\" weight=\"medium\">{header}</Headline>;\n      case IOS:\n        return <Title vkuiClass=\"Alert__header\" weight=\"semibold\" level=\"3\">{header}</Title>;\n      case ANDROID:\n        return <Title vkuiClass=\"Alert__header\" weight=\"medium\" level=\"2\">{header}</Title>;\n    }\n  }\n\n  renderText(text: ReactNode) {\n    switch (this.props.platform) {\n      case VKCOM:\n        return <Caption vkuiClass=\"Alert__text\" level=\"1\" weight=\"regular\">{text}</Caption>;\n      case IOS:\n        return <Caption vkuiClass=\"Alert__text\" level=\"2\" weight=\"regular\">{text}</Caption>;\n      case ANDROID:\n        return <Headline vkuiClass=\"Alert__text\" weight=\"regular\">{text}</Headline>;\n    }\n  }\n\n  renderAction = (action: AlertActionInterface, i: number) => {\n    const { platform } = this.props;\n    if (platform === IOS) {\n      const { Component = 'button' } = action;\n      return (\n        <Tappable\n          Component={action.href ? 'a' : Component}\n          vkuiClass={classNames('Alert__action', `Alert__action--${action.mode}`)}\n          onClick={this.onItemClick(action)}\n          href={action.href}\n          key={`alert-action-${i}`}\n        >\n          {action.title}\n        </Tappable>\n      );\n    }\n    const mode: ButtonProps['mode'] = platform === ANDROID\n      ? 'tertiary'\n      : action.mode === 'cancel' ? 'secondary' : 'primary';\n    return (\n      <Button\n        vkuiClass={classNames('Alert__button', `Alert__button--${action.mode}`)}\n        mode={mode}\n        size=\"m\"\n        onClick={this.onItemClick(action)}\n        Component={action.Component}\n        href={action.href}\n        key={`alert-action-${i}`}\n      >\n        {action.title}\n      </Button>\n    );\n  };\n\n  render() {\n    const { actions, actionsLayout, children, className, style, platform, viewWidth, text, header, ...restProps } = this.props;\n    const { closing } = this.state;\n\n    const resolvedActionsLayout: AlertProps['actionsLayout'] = platform === VKCOM ? 'horizontal' : actionsLayout;\n    const canShowCloseButton = platform === VKCOM || platform === ANDROID && viewWidth >= ViewWidth.SMALL_TABLET;\n    const isDesktop = viewWidth >= ViewWidth.SMALL_TABLET;\n\n    return (\n      <PopoutWrapper\n        className={className}\n        closing={closing}\n        style={style}\n        onClick={this.onClose}\n      >\n        <div\n          {...restProps}\n          ref={this.element}\n          onClick={this.stopPropagation}\n          vkuiClass={classNames(getClassName('Alert', platform), {\n            'Alert--v': resolvedActionsLayout === 'vertical',\n            'Alert--h': resolvedActionsLayout === 'horizontal',\n            'Alert--closing': closing,\n            'Alert--desktop': isDesktop,\n          })}\n        >\n          {canShowCloseButton && <ModalDismissButton onClick={this.onClose} />}\n          <div vkuiClass=\"Alert__content\">\n            {hasReactNode(header) && this.renderHeader(header)}\n            {hasReactNode(text) && this.renderText(text)}\n            {children}\n          </div>\n          <footer vkuiClass=\"Alert__actions\">\n            {actions.map(this.renderAction)}\n          </footer>\n        </div>\n      </PopoutWrapper>\n    );\n  }\n}\n\nexport default withPlatform(withAdaptivity(Alert, {\n  viewWidth: true,\n}));\n"],"file":"Alert.js"}