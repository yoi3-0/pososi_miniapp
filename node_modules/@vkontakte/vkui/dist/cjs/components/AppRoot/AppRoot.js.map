{"version":3,"sources":["../../../../src/components/AppRoot/AppRoot.tsx"],"names":["warn","AppRoot","children","_mode","mode","_embedded","embedded","sizeX","hasMouse","noLegacyClasses","scroll","props","isKeyboardInputActive","rootRef","portalRoot","setPortalRoot","window","document","initialized","current","documentElement","classList","add","classScopingMode","noConflict","process","env","NODE_ENV","noop","portal","createElement","body","appendChild","parentElement","removeChild","parent","classes","concat","remove","SizeType","REGULAR","container","scrollController","content","appRoot"],"mappings":"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","sourcesContent":["import { FC, HTMLAttributes, useMemo, useRef, useState } from 'react';\nimport { useDOM } from '../../lib/dom';\nimport { classNames } from '../../lib/classNames';\nimport { AppRootContext } from './AppRootContext';\nimport { withAdaptivity, SizeType, AdaptivityProps } from '../../hoc/withAdaptivity';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { classScopingMode } from '../../lib/classScopingMode';\nimport { IconSettingsProvider } from '@vkontakte/icons';\nimport { elementScrollController, globalScrollController, ScrollContext, ScrollContextInterface } from './ScrollContext';\nimport { noop } from '../../lib/utils';\nimport { warnOnce } from '../../lib/warnOnce';\nimport { useKeyboardInputTracker } from '../../hooks/useKeyboardInputTracker';\n\n// Используйте classList, но будьте осторожны\n/* eslint-disable no-restricted-properties */\n\nexport interface AppRootProps extends HTMLAttributes<HTMLDivElement>, AdaptivityProps {\n  /** @deprecated Use mode=\"embedded\" */\n  embedded?: boolean;\n  /** Режим встраивания */\n  mode?: 'partial' | 'embedded' | 'full';\n  window?: Window;\n  /** Убирает классы без префикса (.Button) */\n  noLegacyClasses?: boolean;\n  scroll?: 'global' | 'contain';\n}\n\nconst warn = warnOnce('AppRoot');\nexport const AppRoot: FC<AppRootProps> = withAdaptivity(({\n  children, mode: _mode, embedded: _embedded, sizeX, hasMouse, noLegacyClasses = false, scroll = 'global',\n  ...props\n}: AppRootProps) => {\n  // normalize mode\n  const mode = _mode || (_embedded ? 'embedded' : 'full');\n  const isKeyboardInputActive = useKeyboardInputTracker();\n  const rootRef = useRef<HTMLDivElement>();\n  const [portalRoot, setPortalRoot] = useState<HTMLDivElement>(null);\n  const { window, document } = useDOM();\n\n  const initialized = useRef(false);\n  if (!initialized.current) {\n    if (window && mode === 'full') {\n      document.documentElement.classList.add('vkui');\n    }\n    classScopingMode.noConflict = noLegacyClasses;\n    initialized.current = true;\n  }\n\n  if (process.env.NODE_ENV === 'development') {\n    if (scroll !== 'global' && mode !== 'embedded') {\n      warn('Scroll modes only supported in embedded mode');\n    }\n    if (_mode && _embedded) {\n      warn(`mode=\"${mode}\" overrides embedded`);\n    }\n  }\n\n  // setup portal\n  useIsomorphicLayoutEffect(() => {\n    if (mode === 'full') {\n      return noop;\n    }\n\n    const portal = document.createElement('div');\n    portal.classList.add('vkui__portal-root');\n    document.body.appendChild(portal);\n    setPortalRoot(portal);\n    return () => portal.parentElement.removeChild(portal);\n  }, []);\n\n  // setup root classes\n  useIsomorphicLayoutEffect(() => {\n    if (mode === 'partial') {\n      return noop;\n    }\n\n    const parent = rootRef.current.parentElement;\n    const classes = ['vkui__root'].concat(mode === 'embedded' ? 'vkui__root--embedded' : []);\n    parent.classList.add(...classes);\n\n    return () => {\n      parent.classList.remove(...classes);\n      if (mode === 'full') {\n        document.documentElement.classList.remove('vkui');\n      }\n    };\n  }, []);\n\n  // adaptivity handler\n  useIsomorphicLayoutEffect(() => {\n    if (mode === 'partial' || sizeX !== SizeType.REGULAR) {\n      return noop;\n    }\n    const container = mode === 'embedded' ? rootRef.current.parentElement : document.body;\n    container.classList.add('vkui--sizeX-regular');\n    return () => container.classList.remove('vkui--sizeX-regular');\n  }, [sizeX]);\n\n  const scrollController = useMemo<ScrollContextInterface>(\n    () => scroll === 'contain' ? elementScrollController(rootRef) : globalScrollController(window, document),\n    [scroll]);\n\n  const content = (\n    <AppRootContext.Provider value={{\n      appRoot: rootRef,\n      portalRoot: portalRoot,\n      embedded: mode === 'embedded',\n    }}>\n      <ScrollContext.Provider value={scrollController}>\n        <IconSettingsProvider classPrefix=\"vkui\" globalClasses={!noLegacyClasses}>\n          {children}\n        </IconSettingsProvider>\n      </ScrollContext.Provider>\n    </AppRootContext.Provider>\n  );\n\n  return mode === 'partial' ? content : (\n    <div ref={rootRef} vkuiClass={classNames('AppRoot', {\n      'AppRoot--no-mouse': !hasMouse,\n      'AppRoot--keyboard-input': isKeyboardInputActive,\n    })} {...props}>\n      {content}\n    </div>\n  );\n}, {\n  sizeX: true,\n  hasMouse: true,\n});\n\nexport default AppRoot;\n"],"file":"AppRoot.js"}