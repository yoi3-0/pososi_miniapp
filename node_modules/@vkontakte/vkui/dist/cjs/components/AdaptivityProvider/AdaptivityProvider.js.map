{"version":3,"sources":["../../../../src/components/AdaptivityProvider/AdaptivityProvider.tsx"],"names":["DESKTOP_SIZE","TABLET_SIZE","SMALL_TABLET_SIZE","MOBILE_SIZE","MOBILE_LANDSCAPE_HEIGHT","MEDIUM_HEIGHT","AdaptivityProvider","props","adaptivityRef","updateAdaptivity","window","current","calculateAdaptivity","innerWidth","innerHeight","onResize","calculated","viewWidth","viewHeight","sizeX","sizeY","hasMouse","addEventListener","removeEventListener","children","defaultProps","canUseDOM","windowWidth","windowHeight","ViewWidth","SMALL_MOBILE","ViewHeight","SMALL","SizeType","REGULAR","_hasMouse","DESKTOP","TABLET","SMALL_TABLET","MOBILE","MEDIUM","EXTRA_SMALL","COMPACT"],"mappings":"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","sourcesContent":["import { ReactNode, useEffect, useRef, useState } from 'react';\nimport { hasMouse as _hasMouse } from '@vkontakte/vkjs';\nimport { AdaptivityContext, AdaptivityContextInterface, SizeType, ViewHeight, ViewWidth } from './AdaptivityContext';\nimport { canUseDOM, useDOM } from '../../lib/dom';\n\nexport interface AdaptivityProviderProps extends AdaptivityContextInterface {\n  children?: ReactNode;\n}\n\nexport const DESKTOP_SIZE = 1280;\nexport const TABLET_SIZE = 1024;\nexport const SMALL_TABLET_SIZE = 768;\nexport const MOBILE_SIZE = 320;\n\nexport const MOBILE_LANDSCAPE_HEIGHT = 414;\nexport const MEDIUM_HEIGHT = 720;\n\nexport default function AdaptivityProvider(props: AdaptivityProviderProps) {\n  const adaptivityRef = useRef<AdaptivityContextInterface>(null);\n  const [, updateAdaptivity] = useState({});\n\n  const { window } = useDOM();\n\n  if (!adaptivityRef.current) {\n    adaptivityRef.current = calculateAdaptivity(\n      window ? window.innerWidth : 0,\n      window ? window.innerHeight : 0,\n      props,\n    );\n  }\n\n  useEffect(() => {\n    function onResize() {\n      const calculated = calculateAdaptivity(window.innerWidth, window.innerHeight, props);\n      const { viewWidth, viewHeight, sizeX, sizeY, hasMouse } = adaptivityRef.current;\n\n      if (\n        viewWidth !== calculated.viewWidth ||\n        viewHeight !== calculated.viewHeight ||\n        sizeX !== calculated.sizeX ||\n        sizeY !== calculated.sizeY ||\n        hasMouse !== calculated.hasMouse\n      ) {\n        adaptivityRef.current = calculated;\n        updateAdaptivity({});\n      }\n    }\n\n    onResize();\n    window.addEventListener('resize', onResize, false);\n\n    return () => {\n      window.removeEventListener('resize', onResize, false);\n    };\n  }, [props.viewWidth, props.viewHeight, props.sizeX, props.sizeY, props.hasMouse]);\n\n  return (\n    <AdaptivityContext.Provider value={adaptivityRef.current}>\n      {props.children}\n    </AdaptivityContext.Provider>\n  );\n}\n\nAdaptivityProvider.defaultProps = {\n  window: canUseDOM && window,\n};\n\nfunction calculateAdaptivity(windowWidth: number, windowHeight: number, props: AdaptivityProviderProps) {\n  let viewWidth = ViewWidth.SMALL_MOBILE;\n  let viewHeight = ViewHeight.SMALL;\n  let sizeY = SizeType.REGULAR;\n  let sizeX = SizeType.REGULAR;\n  let hasMouse = typeof props.hasMouse === 'boolean' ? props.hasMouse : _hasMouse;\n\n  if (windowWidth >= DESKTOP_SIZE) {\n    viewWidth = ViewWidth.DESKTOP;\n  } else if (windowWidth >= TABLET_SIZE) {\n    viewWidth = ViewWidth.TABLET;\n  } else if (windowWidth >= SMALL_TABLET_SIZE) {\n    viewWidth = ViewWidth.SMALL_TABLET;\n  } else if (windowWidth >= MOBILE_SIZE) {\n    viewWidth = ViewWidth.MOBILE;\n  } else {\n    viewWidth = ViewWidth.SMALL_MOBILE;\n  }\n\n  if (windowHeight >= MEDIUM_HEIGHT) {\n    viewHeight = ViewHeight.MEDIUM;\n  } else if (windowHeight > MOBILE_LANDSCAPE_HEIGHT) {\n    viewHeight = ViewHeight.SMALL;\n  } else {\n    viewHeight = ViewHeight.EXTRA_SMALL;\n  }\n\n  props.viewWidth && (viewWidth = props.viewWidth);\n  props.viewHeight && (viewHeight = props.viewHeight);\n\n  if (viewWidth <= ViewWidth.MOBILE) {\n    sizeX = SizeType.COMPACT;\n  }\n\n  if (viewWidth >= ViewWidth.SMALL_TABLET && hasMouse || viewHeight <= ViewHeight.EXTRA_SMALL) {\n    sizeY = SizeType.COMPACT;\n  }\n\n  props.sizeX && (sizeX = props.sizeX);\n  props.sizeY && (sizeY = props.sizeY);\n\n  return { viewWidth, viewHeight, sizeX, sizeY, hasMouse };\n}\n"],"file":"AdaptivityProvider.js"}