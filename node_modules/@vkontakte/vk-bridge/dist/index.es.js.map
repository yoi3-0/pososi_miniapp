{"version":3,"file":"index.es.js","sources":["../src/promisifySend.ts","../src/bridge.ts","../src/custom-event.ts","../src/applyMiddleware.ts","../src/index.ts"],"sourcesContent":["import {\n  VKBridgeSubscribeHandler,\n  AnyRequestMethodName,\n  RequestProps,\n  RequestIdProp,\n  ReceiveData,\n  AnyReceiveMethodName,\n} from './types/bridge';\n\n/**\n * Creates counter interface.\n */\nfunction createCounter() {\n  return {\n    current: 0,\n    next() {\n      return ++this.current;\n    },\n  };\n}\n\n/**\n * Creates interface for resolving request promises by request id's (or not).\n */\nfunction createRequestResolver() {\n  /**\n   * @prop resolve Resolve function.\n   * @prop reject Reject function.\n   */\n  type PromiseController = {\n    resolve: (value: any) => any;\n    reject: (reason: any) => any;\n  };\n\n  const counter = createCounter();\n  const promiseControllers: Record<number | string, PromiseController | null> = {};\n\n  return {\n    /**\n     * Adds new controller with resolve/reject methods.\n     *\n     * @param controller Object with `resolve` and `reject` functions\n     * @param customId Custom `request_id`\n     * @returns New request id of the added controller.\n     */\n    add(controller: PromiseController, customId?: number | string): number | string {\n      const id = customId != null ? customId : counter.next();\n\n      promiseControllers[id] = controller;\n\n      return id;\n    },\n\n    /**\n     * Resolves/rejects an added promise by request id and the `isSuccess`\n     * predicate.\n     *\n     * @param requestId Request ID.\n     * @param data Data to pass to the resolve- or reject-function.\n     * @param isSuccess Predicate to select the desired function.\n     */\n    resolve<T>(requestId: number | string, data: T, isSuccess: (data: T) => boolean) {\n      const requestPromise = promiseControllers[requestId];\n\n      if (requestPromise) {\n        if (isSuccess(data)) {\n          requestPromise.resolve(data);\n        } else {\n          requestPromise.reject(data);\n        }\n\n        promiseControllers[requestId] = null;\n      }\n    },\n  };\n}\n\n/**\n * Returns send function that returns promises.\n *\n * @param sendEvent Send event function.\n * @param subscribe Subscribe event function.\n * @returns Send function which returns the Promise object.\n */\nexport function promisifySend(\n  sendEvent: <K extends AnyRequestMethodName>(method: K, props?: RequestProps<K> & RequestIdProp) => void,\n  subscribe: (fn: VKBridgeSubscribeHandler) => void\n) {\n  const requestResolver = createRequestResolver();\n\n  // Subscribe to receive a data\n  subscribe((event) => {\n    if (!event.detail || !event.detail.data || typeof event.detail.data !== 'object') {\n      return;\n    }\n\n    // There is no request_id in receive-only events, so we check its existence.\n    if ('request_id' in event.detail.data) {\n      const { request_id: requestId, ...data } = event.detail.data;\n\n      if (requestId) {\n        requestResolver.resolve(requestId, data, (data) => !('error_type' in data));\n      }\n    }\n  });\n\n  return function promisifiedSend<K extends AnyRequestMethodName>(\n    method: K,\n    props: RequestProps<K> & RequestIdProp = {} as RequestProps<K> & RequestIdProp\n  ): Promise<K extends AnyReceiveMethodName ? ReceiveData<K> : void> {\n    return new Promise((resolve, reject) => {\n      const requestId = requestResolver.add({ resolve, reject }, props.request_id);\n\n      sendEvent(method, {\n        ...props,\n        request_id: requestId,\n      });\n    });\n  };\n}\n","import { promisifySend } from './promisifySend';\nimport { VKBridge, VKBridgeSubscribeHandler, AnyRequestMethodName, RequestProps, RequestIdProp } from './types/bridge';\n\n/** Is the client side runtime environment */\nexport const IS_CLIENT_SIDE = typeof window !== 'undefined';\n\n/** Is the runtime environment an Android app */\nexport const IS_ANDROID_WEBVIEW = Boolean(IS_CLIENT_SIDE && (window as any).AndroidBridge);\n\n/** Is the runtime environment an iOS app */\nexport const IS_IOS_WEBVIEW = Boolean(\n  IS_CLIENT_SIDE &&\n    (window as any).webkit &&\n    (window as any).webkit.messageHandlers &&\n    (window as any).webkit.messageHandlers.VKWebAppClose\n);\n\n/** Is the runtime environment a browser */\nexport const IS_WEB = IS_CLIENT_SIDE && !IS_ANDROID_WEBVIEW && !IS_IOS_WEBVIEW;\n\n/** Is the runtime environment m.vk.com */\nexport const IS_MVK = IS_WEB && /(^\\?|&)vk_platform=mobile_web(&|$)/.test(location.search);\n\n/** Is the runtime environment vk.com */\nexport const IS_DESKTOP_VK = IS_WEB && !IS_MVK;\n\n/** Type of subscribe event */\nexport const EVENT_TYPE = IS_WEB ? 'message' : 'VKWebAppEvent';\n\n/** Methods supported on the desktop */\nexport const DESKTOP_METHODS = [\n  'VKWebAppInit',\n  'VKWebAppGetCommunityAuthToken',\n  'VKWebAppAddToCommunity',\n  'VKWebAppAddToHomeScreenInfo',\n  'VKWebAppClose',\n  'VKWebAppCopyText',\n  'VKWebAppGetUserInfo',\n  'VKWebAppSetLocation',\n  'VKWebAppSendToClient',\n  'VKWebAppGetClientVersion',\n  'VKWebAppGetPhoneNumber',\n  'VKWebAppGetEmail',\n  'VKWebAppGetGroupInfo',\n  'VKWebAppGetGeodata',\n  'VKWebAppGetCommunityToken',\n  'VKWebAppSetTitle',\n  'VKWebAppGetAuthToken',\n  'VKWebAppCallAPIMethod',\n  'VKWebAppJoinGroup',\n  'VKWebAppLeaveGroup',\n  'VKWebAppAllowMessagesFromGroup',\n  'VKWebAppDenyNotifications',\n  'VKWebAppAllowNotifications',\n  'VKWebAppOpenPayForm',\n  'VKWebAppOpenApp',\n  'VKWebAppShare',\n  'VKWebAppShowWallPostBox',\n  'VKWebAppScroll',\n  'VKWebAppShowOrderBox',\n  'VKWebAppShowLeaderBoardBox',\n  'VKWebAppShowInviteBox',\n  'VKWebAppShowRequestBox',\n  'VKWebAppAddToFavorites',\n  'VKWebAppShowCommunityWidgetPreviewBox',\n  'VKWebAppShowStoryBox',\n  'VKWebAppStorageGet',\n  'VKWebAppStorageGetKeys',\n  'VKWebAppStorageSet',\n  'VKWebAppFlashGetInfo',\n  'VKWebAppSubscribeStoryApp',\n  'VKWebAppOpenWallPost',\n  'VKWebAppCheckAllowedScopes',\n  'VKWebAppShowNativeAds',\n\n  // Desktop web specific events\n  ...(IS_DESKTOP_VK ? ['VKWebAppResizeWindow', 'VKWebAppAddToMenu', 'VKWebAppShowSubscriptionBox', 'VKWebAppShowInstallPushBox', 'VKWebAppGetFriends'] : ['VKWebAppShowImages']),\n];\n\n/** Android VK Bridge interface. */\nconst androidBridge: Record<string, (serializedData: string) => void> | undefined = IS_CLIENT_SIDE\n  ? (window as any).AndroidBridge\n  : undefined;\n\n/** iOS VK Bridge interface. */\nconst iosBridge: Record<string, { postMessage?: (data: any) => void }> | undefined = IS_IOS_WEBVIEW\n  ? (window as any).webkit.messageHandlers\n  : undefined;\n\n/**\n * Creates a VK Bridge API that holds functions for interact with runtime\n * environment.\n *\n * @param version Version of the package\n */\nexport function createVKBridge(version: string): VKBridge {\n  /** Current frame id. */\n  let webFrameId: string | undefined = undefined;\n\n  /** List of functions that subscribed on events. */\n  const subscribers: VKBridgeSubscribeHandler[] = [];\n\n  /**\n   * Sends an event to the runtime env. In the case of Android/iOS application\n   * env is the application itself. In the case of the browser, the parent\n   * frame in which the event handlers is located.\n   *\n   * @param method The method (event) name to send\n   * @param [props] Method properties\n   */\n  function send<K extends AnyRequestMethodName>(method: K, props?: RequestProps<K> & RequestIdProp) {\n    // Sending data through Android bridge\n    if (androidBridge && androidBridge[method]) {\n      androidBridge[method](JSON.stringify(props));\n    }\n\n    // Sending data through iOS bridge\n    else if (iosBridge && iosBridge[method] && typeof iosBridge[method].postMessage === 'function') {\n      iosBridge[method].postMessage!(props);\n    }\n\n    // Sending data through web bridge\n    else if (IS_WEB) {\n      parent.postMessage(\n        {\n          handler: method,\n          params: props,\n          type: 'vk-connect',\n          webFrameId,\n          connectVersion: version,\n        },\n        '*'\n      );\n    }\n  }\n\n  /**\n   * Adds an event listener. It will be called any time a data is received.\n   *\n   * @param listener A callback to be invoked on every event receive.\n   */\n  function subscribe(listener: VKBridgeSubscribeHandler) {\n    subscribers.push(listener);\n  }\n\n  /**\n   * Removes an event listener which has been subscribed for event listening.\n   *\n   * @param listener A callback to unsubscribe.\n   */\n  function unsubscribe(listener: VKBridgeSubscribeHandler) {\n    const index = subscribers.indexOf(listener);\n\n    if (index > -1) {\n      subscribers.splice(index, 1);\n    }\n  }\n\n  /**\n   * Checks if a method is supported on runtime platform.\n   *\n   * @param method Method (event) name to check.\n   * @returns Result of checking.\n   */\n  function supports<K extends AnyRequestMethodName>(method: K): boolean {\n    if (IS_ANDROID_WEBVIEW) {\n      // Android support check\n      return !!(androidBridge && typeof androidBridge[method] === 'function');\n    } else if (IS_IOS_WEBVIEW) {\n      // iOS support check\n      return !!(iosBridge && iosBridge[method] && typeof iosBridge[method].postMessage === 'function');\n    } else if (IS_WEB) {\n      // Web support check\n      return DESKTOP_METHODS.indexOf(method) > -1;\n    }\n\n    return false;\n  }\n\n  /**\n   * Checks whether the runtime is a WebView.\n   *\n   * @returns Result of checking.\n   */\n  function isWebView(): boolean {\n    return IS_IOS_WEBVIEW || IS_ANDROID_WEBVIEW;\n  }\n\n  /**\n   * Checks whether the runtime is an iframe.\n   *\n   * @returns Result of checking.\n   */\n  function isIframe(): boolean {\n    return IS_WEB && window.parent !== window;\n  }\n\n  /**\n   * Checks whether the runtime is embedded.\n   *\n   * @returns Result of checking.\n   */\n  function isEmbedded(): boolean {\n    return isWebView() || isIframe();\n  }\n\n  /**\n   * Checks whether the runtime is standalone.\n   *\n   * @returns Result of checking.\n   */\n  function isStandalone(): boolean {\n    return !isEmbedded();\n  }\n\n  // Subscribes to listening messages from a runtime for calling each\n  // subscribed event listener.\n  if (typeof window !== 'undefined' && 'addEventListener' in window) {\n    window.addEventListener(EVENT_TYPE, (event: any) => {\n      if (IS_IOS_WEBVIEW || IS_ANDROID_WEBVIEW) {\n        // If it's webview\n        return [...subscribers].map((fn) => fn.call(null, event));\n      } else if (IS_WEB && event && event.data) {\n        // If it's web\n        const { type, data, frameId } = event.data;\n\n        if (type && type === 'VKWebAppSettings') {\n          webFrameId = frameId;\n        } else {\n          [...subscribers].map((fn) => fn({ detail: { type, data } }));\n        }\n      }\n    });\n  }\n\n  /**\n   * Enhanced send functions for the ability to receive response data in\n   * the Promise object.\n   */\n  const sendPromise = promisifySend(send, subscribe);\n\n  return {\n    send: sendPromise,\n    sendPromise,\n    subscribe,\n    unsubscribe,\n    supports,\n    isWebView,\n    isIframe,\n    isEmbedded,\n    isStandalone,\n  };\n}\n","/**\n * Creates the CustomEvent polyfill. VK apps use the CustomEvent for transfer\n * data.\n */\nexport function createCustomEventPolyfill() {\n  function CustomEvent<T>(typeArg: string, eventInitDict?: CustomEventInit<T>): CustomEvent<T> {\n    const params = eventInitDict || { bubbles: false, cancelable: false, detail: undefined };\n\n    const evt = document.createEvent('CustomEvent');\n    evt.initCustomEvent(typeArg, !!params.bubbles, !!params.cancelable, params.detail);\n\n    return evt;\n  }\n\n  CustomEvent.prototype = Event.prototype;\n\n  return CustomEvent;\n}\n","import { VKBridge, VKBridgeSend } from './types/bridge';\nimport { Middleware, MiddlewareAPI } from './types/middleware';\n\n/**\n * Creates the VK Bridge enhancer that applies middleware to the `send`\n * method. This is handy for a variety of task such as logging every sent\n * event.\n *\n * @param middlewares The middleware chain to be applied.\n * @returns The VK Bridge enhancer applying the middleware.\n */\nexport function applyMiddleware(...middlewares: Array<Middleware | undefined | null>): (bridge: VKBridge) => VKBridge {\n  if (middlewares.includes(undefined) || middlewares.includes(null)) {\n    return applyMiddleware(...middlewares.filter((item): item is Middleware => typeof item === 'function'));\n  }\n\n  return (bridge) => {\n    if (middlewares.length === 0) {\n      return bridge;\n    }\n\n    let send: VKBridgeSend = () => {\n      throw new Error(\n        'Sending events while constructing your middleware is not allowed. ' +\n          'Other middleware would not be applied to this send.'\n      );\n    };\n\n    const middlewareAPI: MiddlewareAPI = {\n      subscribe: bridge.subscribe,\n      send: (...args) => bridge.send(...args),\n    };\n\n    const chain = middlewares\n      .filter((item): item is Middleware => typeof item === 'function')\n      .map((middleware) => middleware(middlewareAPI)) //\n      .reduce((a, b) => (send) => a(b(send)));\n\n    send = chain(bridge.send);\n\n    return {\n      ...bridge,\n      send,\n    };\n  };\n}\n","import { createVKBridge } from './bridge';\nimport { createCustomEventPolyfill } from './custom-event';\nimport { version } from '../package.json';\nimport './custom-event';\n\n// Applying CustomEvent polyfill\nif (typeof window !== 'undefined' && !window.CustomEvent) {\n  (window as any).CustomEvent = createCustomEventPolyfill();\n}\n\n// VK Bridge API\nconst bridge = createVKBridge(version);\n\n// Export typings\nexport * from './types/data';\nexport * from './types/bridge';\nexport * from './types/middleware';\nexport * from './types/deprecated';\n\nexport { applyMiddleware } from './applyMiddleware';\nexport { bridge as default };\n"],"names":[],"mappings":"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"}